!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=self;!function(a){function e(a,b,c){for(var d=(c||0)-1,e=a.length;++d<e;)if(a[d]===b)return d;return-1}function f(a,b){var c=typeof b;if(a=a.cache,"boolean"==c||null==b)return a[b];"number"!=c&&"string"!=c&&(c="object");var d="number"==c?b:w+b;return a=a[c]||(a[c]={}),"object"==c?a[d]&&e(a[d],b)>-1?0:-1:a[d]?0:-1}function g(a){var b=this.cache,c=typeof a;if("boolean"==c||null==a)b[a]=!0;else{"number"!=c&&"string"!=c&&(c="object");var d="number"==c?a:w+a,e=b[c]||(b[c]={});"object"==c?(e[d]||(e[d]=[])).push(a)==this.array.length&&(b[c]=!1):e[d]=!0}}function h(a){return a.charCodeAt(0)}function i(a,b){var c=a.index,d=b.index;if(a=a.criteria,b=b.criteria,a!==b){if(a>b||"undefined"==typeof a)return 1;if(b>a||"undefined"==typeof b)return-1}return d>c?-1:1}function j(a){var b=-1,c=a.length,d=m();d["false"]=d["null"]=d["true"]=d.undefined=!1;var e=m();for(e.array=a,e.cache=d,e.push=g;++b<c;)e.push(a[b]);return d.object===!1?(o(e),null):e}function k(a){return"\\"+Z[a]}function l(){return s.pop()||[]}function m(){return t.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,leading:!1,maxWait:0,"null":!1,number:null,object:null,push:null,string:null,trailing:!1,"true":!1,undefined:!1,value:null}}function n(a){a.length=0,s.length<y&&s.push(a)}function o(a){var b=a.cache;b&&o(b),a.array=a.cache=a.criteria=a.object=a.number=a.string=a.value=null,t.length<y&&t.push(a)}function p(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);for(var d=-1,e=c-b||0,f=Array(0>e?0:e);++d<e;)f[d]=a[b+d];return f}function q(b){function c(a){return a&&"object"==typeof a&&!Bd(a)&&hd.call(a,"__wrapped__")?a:new d(a)}function d(a){this.__wrapped__=a}function g(a,b,c,d){function e(){var d=arguments,j=g?this:b;if(f||(a=b[h]),c.length&&(d=d.length?(d=wd.call(d),i?d.concat(c):c.concat(d)):c),this instanceof e){j=s(a.prototype);var k=a.apply(j,d);return qb(k)?k:j}return a.apply(j,d)}var f=pb(a),g=!c,h=b;if(g){var i=d;c=b}else if(!f){if(!d)throw new Yc;b=a}return e}function s(a){return qb(a)?nd(a):{}}function t(a){return Ed[a]}function y(){var a=(a=c.indexOf)===ac?e:a;return a}function Z(a){return function(b,d,e,f){return"boolean"!=typeof d&&null!=d&&(f=e,e=f&&f[d]===b?r:d,d=!1),null!=e&&(e=c.createCallback(e,f)),a(b,d,e,f)}}function $(a){var b,c;return a&&ld.call(a)==U&&(b=a.constructor,!pb(b)||b instanceof b)?(Id(a,function(a,b){c=b}),c===r||hd.call(a,c)):!1}function ab(a){return Fd[a]}function cb(a){return ld.call(a)==O}function db(a,b,d,e,f,g){var h=a;if("boolean"!=typeof b&&null!=b&&(e=d,d=b,b=!1),"function"==typeof d){if(d="undefined"==typeof e?d:c.createCallback(d,e,1),h=d(h),"undefined"!=typeof h)return h;h=a}var i=qb(h);if(i){var j=ld.call(h);if(!X[j])return h;var k=Bd(h)}if(!i||!b)return i?k?p(h):Gd({},h):h;var m=zd[j];switch(j){case Q:case R:return new m(+h);case T:case W:return new m(h);case V:return m(h.source,E.exec(h))}var o=!f;f||(f=l()),g||(g=l());for(var q=f.length;q--;)if(f[q]==a)return g[q];return h=k?m(h.length):{},k&&(hd.call(a,"index")&&(h.index=a.index),hd.call(a,"input")&&(h.input=a.input)),f.push(a),g.push(h),(k?Jb:Jd)(a,function(a,c){h[c]=db(a,b,d,r,f,g)}),o&&(n(f),n(g)),h}function eb(a,b,c){return db(a,!0,b,c)}function fb(a,b,d){var e;return b=c.createCallback(b,d),Jd(a,function(a,c,d){return b(a,c,d)?(e=c,!1):void 0}),e}function gb(a){var b=[];return Id(a,function(a,c){pb(a)&&b.push(c)}),b.sort()}function hb(a,b){return a?hd.call(a,b):!1}function ib(a){for(var b=-1,c=Dd(a),d=c.length,e={};++b<d;){var f=c[b];e[a[f]]=f}return e}function jb(a){return a===!0||a===!1||ld.call(a)==Q}function kb(a){return a?"object"==typeof a&&ld.call(a)==R:!1}function lb(a){return a?1===a.nodeType:!1}function mb(a){var b=!0;if(!a)return b;var c=ld.call(a),d=a.length;return c==P||c==W||c==O||c==U&&"number"==typeof d&&pb(a.splice)?!d:(Jd(a,function(){return b=!1}),b)}function nb(a,b,d,e,f,g){var h=d===v;if("function"==typeof d&&!h){d=c.createCallback(d,e,2);var i=d(a,b);if("undefined"!=typeof i)return!!i}if(a===b)return 0!==a||1/a==1/b;var j=typeof a,k=typeof b;if(a===a&&(!a||"function"!=j&&"object"!=j)&&(!b||"function"!=k&&"object"!=k))return!1;if(null==a||null==b)return a===b;var m=ld.call(a),o=ld.call(b);if(m==O&&(m=U),o==O&&(o=U),m!=o)return!1;switch(m){case Q:case R:return+a==+b;case T:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case V:case W:return a==Xc(b)}var p=m==P;if(!p){if(hd.call(a,"__wrapped__ ")||hd.call(b,"__wrapped__"))return nb(a.__wrapped__||a,b.__wrapped__||b,d,e,f,g);if(m!=U)return!1;var q=a.constructor,r=b.constructor;if(q!=r&&!(pb(q)&&q instanceof q&&pb(r)&&r instanceof r))return!1}var s=!f;f||(f=l()),g||(g=l());for(var t=f.length;t--;)if(f[t]==a)return g[t]==b;var u=0;if(i=!0,f.push(a),g.push(b),p){if(t=a.length,u=b.length,i=u==a.length,!i&&!h)return i;for(;u--;){var w=t,x=b[u];if(h)for(;w--&&!(i=nb(a[w],x,d,e,f,g)););else if(!(i=nb(a[u],x,d,e,f,g)))break}return i}return Id(b,function(b,c,h){return hd.call(h,c)?(u++,i=hd.call(a,c)&&nb(a[c],b,d,e,f,g)):void 0}),i&&!h&&Id(a,function(a,b,c){return hd.call(c,b)?i=--u>-1:void 0}),s&&(n(f),n(g)),i}function ob(a){return pd(a)&&!qd(parseFloat(a))}function pb(a){return"function"==typeof a}function qb(a){return!(!a||!Y[typeof a])}function rb(a){return tb(a)&&a!=+a}function sb(a){return null===a}function tb(a){return"number"==typeof a||ld.call(a)==T}function ub(a){return a?"object"==typeof a&&ld.call(a)==V:!1}function vb(a){return"string"==typeof a||ld.call(a)==W}function wb(a){return"undefined"==typeof a}function xb(a,b,d){var e=arguments,f=0,g=2;if(!qb(a))return a;if(d===v)var h=e[3],i=e[4],j=e[5];else{var k=!0;i=l(),j=l(),"number"!=typeof d&&(g=e.length),g>3&&"function"==typeof e[g-2]?h=c.createCallback(e[--g-1],e[g--],2):g>2&&"function"==typeof e[g-1]&&(h=e[--g])}for(;++f<g;)(Bd(e[f])?Jb:Jd)(e[f],function(b,c){var d,e,f=b,g=a[c];if(b&&((e=Bd(b))||Kd(b))){for(var k=i.length;k--;)if(d=i[k]==b){g=j[k];break}if(!d){var l;h&&(f=h(g,b),(l="undefined"!=typeof f)&&(g=f)),l||(g=e?Bd(g)?g:[]:Kd(g)?g:{}),i.push(b),j.push(g),l||(g=xb(g,b,v,h,i,j))}}else h&&(f=h(g,b),"undefined"==typeof f&&(f=b)),"undefined"!=typeof f&&(g=f);a[c]=g});return k&&(n(i),n(j)),a}function yb(a,b,d){var e=y(),f="function"==typeof b,g={};if(f)b=c.createCallback(b,d);else var h=dd.apply(Zc,wd.call(arguments,1));return Id(a,function(a,c,d){(f?!b(a,c,d):e(h,c)<0)&&(g[c]=a)}),g}function zb(a){for(var b=-1,c=Dd(a),d=c.length,e=Pc(d);++b<d;){var f=c[b];e[b]=[f,a[f]]}return e}function Ab(a,b,d){var e={};if("function"!=typeof b)for(var f=-1,g=dd.apply(Zc,wd.call(arguments,1)),h=qb(a)?g.length:0;++f<h;){var i=g[f];i in a&&(e[i]=a[i])}else b=c.createCallback(b,d),Id(a,function(a,c,d){b(a,c,d)&&(e[c]=a)});return e}function Bb(a,b,d,e){var f=Bd(a);if(b=c.createCallback(b,e,4),null==d)if(f)d=[];else{var g=a&&a.constructor,h=g&&g.prototype;d=s(h)}return(f?Jb:Jd)(a,function(a,c,e){return b(d,a,c,e)}),d}function Cb(a){for(var b=-1,c=Dd(a),d=c.length,e=Pc(d);++b<d;)e[b]=a[c[b]];return e}function Db(a){for(var b=-1,c=dd.apply(Zc,wd.call(arguments,1)),d=c.length,e=Pc(d);++b<d;)e[b]=a[c[b]];return e}function Eb(a,b,c){var d=-1,e=y(),f=a?a.length:0,g=!1;return c=(0>c?sd(0,f+c):c)||0,f&&"number"==typeof f?g=(vb(a)?a.indexOf(b,c):e(a,b,c))>-1:Jd(a,function(a){return++d>=c?!(g=a===b):void 0}),g}function Fb(a,b,d){var e={};return b=c.createCallback(b,d),Jb(a,function(a,c,d){c=Xc(b(a,c,d)),hd.call(e,c)?e[c]++:e[c]=1}),e}function Gb(a,b,d){var e=!0;b=c.createCallback(b,d);var f=-1,g=a?a.length:0;if("number"==typeof g)for(;++f<g&&(e=!!b(a[f],f,a)););else Jd(a,function(a,c,d){return e=!!b(a,c,d)});return e}function Hb(a,b,d){var e=[];b=c.createCallback(b,d);var f=-1,g=a?a.length:0;if("number"==typeof g)for(;++f<g;){var h=a[f];b(h,f,a)&&e.push(h)}else Jd(a,function(a,c,d){b(a,c,d)&&e.push(a)});return e}function Ib(a,b,d){b=c.createCallback(b,d);var e=-1,f=a?a.length:0;if("number"!=typeof f){var g;return Jd(a,function(a,c,d){return b(a,c,d)?(g=a,!1):void 0}),g}for(;++e<f;){var h=a[e];if(b(h,e,a))return h}}function Jb(a,b,d){var e=-1,f=a?a.length:0;if(b=b&&"undefined"==typeof d?b:c.createCallback(b,d),"number"==typeof f)for(;++e<f&&b(a[e],e,a)!==!1;);else Jd(a,b);return a}function Kb(a,b,d){var e={};return b=c.createCallback(b,d),Jb(a,function(a,c,d){c=Xc(b(a,c,d)),(hd.call(e,c)?e[c]:e[c]=[]).push(a)}),e}function Lb(a,b){var c=wd.call(arguments,2),d=-1,e="function"==typeof b,f=a?a.length:0,g=Pc("number"==typeof f?f:0);return Jb(a,function(a){g[++d]=(e?b:a[b]).apply(a,c)}),g}function Mb(a,b,d){var e=-1,f=a?a.length:0;if(b=c.createCallback(b,d),"number"==typeof f)for(var g=Pc(f);++e<f;)g[e]=b(a[e],e,a);else g=[],Jd(a,function(a,c,d){g[++e]=b(a,c,d)});return g}function Nb(a,b,d){var e=-1/0,f=e;if(!b&&Bd(a))for(var g=-1,i=a.length;++g<i;){var j=a[g];j>f&&(f=j)}else b=!b&&vb(a)?h:c.createCallback(b,d),Jb(a,function(a,c,d){var g=b(a,c,d);g>e&&(e=g,f=a)});return f}function Ob(a,b,d){var e=1/0,f=e;if(!b&&Bd(a))for(var g=-1,i=a.length;++g<i;){var j=a[g];f>j&&(f=j)}else b=!b&&vb(a)?h:c.createCallback(b,d),Jb(a,function(a,c,d){var g=b(a,c,d);e>g&&(e=g,f=a)});return f}function Pb(a,b){var c=-1,d=a?a.length:0;if("number"==typeof d)for(var e=Pc(d);++c<d;)e[c]=a[c][b];return e||Mb(a,b)}function Qb(a,b,d,e){if(!a)return d;var f=arguments.length<3;b=c.createCallback(b,e,4);var g=-1,h=a.length;if("number"==typeof h)for(f&&(d=a[++g]);++g<h;)d=b(d,a[g],g,a);else Jd(a,function(a,c,e){d=f?(f=!1,a):b(d,a,c,e)});return d}function Rb(a,b,d,e){var f=a,g=a?a.length:0,h=arguments.length<3;if("number"!=typeof g){var i=Dd(a);g=i.length}return b=c.createCallback(b,e,4),Jb(a,function(a,c,e){c=i?i[--g]:--g,d=h?(h=!1,f[c]):b(d,f[c],c,e)}),d}function Sb(a,b,d){return b=c.createCallback(b,d),Hb(a,function(a,c,d){return!b(a,c,d)})}function Tb(a){var b=-1,c=a?a.length:0,d=Pc("number"==typeof c?c:0);return Jb(a,function(a){var c=ed(vd()*(++b+1));d[b]=d[c],d[c]=a}),d}function Ub(a){var b=a?a.length:0;return"number"==typeof b?b:Dd(a).length}function Vb(a,b,d){var e;b=c.createCallback(b,d);var f=-1,g=a?a.length:0;if("number"==typeof g)for(;++f<g&&!(e=b(a[f],f,a)););else Jd(a,function(a,c,d){return!(e=b(a,c,d))});return!!e}function Wb(a,b,d){var e=-1,f=a?a.length:0,g=Pc("number"==typeof f?f:0);for(b=c.createCallback(b,d),Jb(a,function(a,c,d){var f=g[++e]=m();f.criteria=b(a,c,d),f.index=e,f.value=a}),f=g.length,g.sort(i);f--;){var h=g[f];g[f]=h.value,o(h)}return g}function Xb(a){return a&&"number"==typeof a.length?p(a):Cb(a)}function Yb(a){for(var b=-1,c=a?a.length:0,d=[];++b<c;){var e=a[b];e&&d.push(e)}return d}function Zb(a){var b=-1,c=y(),d=a?a.length:0,g=dd.apply(Zc,wd.call(arguments,1)),h=[],i=d>=x&&c===e;if(i){var k=j(g);k?(c=f,g=k):i=!1}for(;++b<d;){var l=a[b];c(g,l)<0&&h.push(l)}return i&&o(g),h}function $b(a,b,d){var e=-1,f=a?a.length:0;for(b=c.createCallback(b,d);++e<f;)if(b(a[e],e,a))return e;return-1}function _b(a,b,d){if(a){var e=0,f=a.length;if("number"!=typeof b&&null!=b){var g=-1;for(b=c.createCallback(b,d);++g<f&&b(a[g],g,a);)e++}else if(e=b,null==e||d)return a[0];return p(a,0,td(sd(0,e),f))}}function ac(a,b,c){if("number"==typeof c){var d=a?a.length:0;c=0>c?sd(0,d+c):c||0}else if(c){var f=hc(a,b);return a[f]===b?f:-1}return a?e(a,b,c):-1}function bc(a,b,d){if(!a)return[];var e=0,f=a.length;if("number"!=typeof b&&null!=b){var g=f;for(b=c.createCallback(b,d);g--&&b(a[g],g,a);)e++}else e=null==b||d?1:b||e;return p(a,0,td(sd(0,f-e),f))}function cc(a){for(var b=arguments,c=b.length,d=-1,g=l(),h=-1,i=y(),k=a?a.length:0,m=[],p=l();++d<c;){var q=b[d];g[d]=i===e&&(q?q.length:0)>=x&&j(d?b[d]:p)}a:for(;++h<k;){var r=g[0];if(q=a[h],(r?f(r,q):i(p,q))<0){for(d=c,(r||p).push(q);--d;)if(r=g[d],(r?f(r,q):i(b[d],q))<0)continue a;m.push(q)}}for(;c--;)r=g[c],r&&o(r);return n(g),n(p),m}function dc(a,b,d){if(a){var e=0,f=a.length;if("number"!=typeof b&&null!=b){var g=f;for(b=c.createCallback(b,d);g--&&b(a[g],g,a);)e++}else if(e=b,null==e||d)return a[f-1];return p(a,sd(0,f-e))}}function ec(a,b,c){var d=a?a.length:0;for("number"==typeof c&&(d=(0>c?sd(0,d+c):td(c,d-1))+1);d--;)if(a[d]===b)return d;return-1}function fc(a,b,c){a=+a||0,c=+c||1,null==b&&(b=a,a=0);for(var d=-1,e=sd(0,bd((b-a)/c)),f=Pc(e);++d<e;)f[d]=a,a+=c;return f}function gc(a,b,d){if("number"!=typeof b&&null!=b){var e=0,f=-1,g=a?a.length:0;for(b=c.createCallback(b,d);++f<g&&b(a[f],f,a);)e++}else e=null==b||d?1:sd(0,b);return p(a,e)}function hc(a,b,d,e){var f=0,g=a?a.length:f;for(d=d?c.createCallback(d,e,1):Dc,b=d(b);g>f;){var h=f+g>>>1;d(a[h])<b?f=h+1:g=h}return f}function ic(a){return Bd(a)||(arguments[0]=a?wd.call(a):Zc),Nd(dd.apply(Zc,arguments))}function jc(a){for(var b=-1,c=a?Nb(Pb(a,"length")):0,d=Pc(0>c?0:c);++b<c;)d[b]=Pb(a,b);return d}function kc(a){return Zb(a,wd.call(arguments,1))}function lc(a){return a?jc(arguments):[]}function mc(a,b){for(var c=-1,d=a?a.length:0,e={};++c<d;){var f=a[c];b?e[f]=b[c]:e[f[0]]=f[1]}return e}function nc(a,b){return 1>a?b():function(){return--a<1?b.apply(this,arguments):void 0}}function oc(a,b){return Ad.fastBind||md&&arguments.length>2?md.call.apply(md,arguments):g(a,b,wd.call(arguments,2))}function pc(a){for(var b=arguments.length>1?dd.apply(Zc,wd.call(arguments,1)):gb(a),c=-1,d=b.length;++c<d;){var e=b[c];a[e]=oc(a[e],a)}return a}function qc(a,b){return g(a,b,wd.call(arguments,2),v)}function rc(){var a=arguments;return function(){for(var b=arguments,c=a.length;c--;)b=[a[c].apply(this,b)];return b[0]}}function sc(a,b,c){if(null==a)return Dc;var d=typeof a;if("function"!=d){if("object"!=d)return function(b){return b[a]};var e=Dd(a);return function(b){for(var c=e.length,d=!1;c--&&(d=nb(b[e[c]],a[e[c]],v)););return d}}return"undefined"==typeof b||G&&!G.test(fd.call(a))?a:1===c?function(c){return a.call(b,c)}:2===c?function(c,d){return a.call(b,c,d)}:4===c?function(c,d,e,f){return a.call(b,c,d,e,f)}:function(c,d,e){return a.call(b,c,d,e)}}function tc(a,b,c){function d(){cd(m),cd(n),j=0,m=n=null}function e(){var b=o&&(!p||j>1);d(),b&&(l!==!1&&(k=new Rc),h=a.apply(i,g))}function f(){d(),(o||l!==b)&&(k=new Rc,h=a.apply(i,g))}var g,h,i,j=0,k=0,l=!1,m=null,n=null,o=!0;if(b=sd(0,b||0),c===!0){var p=!0;o=!1}else qb(c)&&(p=c.leading,l="maxWait"in c&&sd(b,c.maxWait||0),o="trailing"in c?c.trailing:o);return function(){if(g=arguments,i=this,j++,cd(n),l===!1)p&&2>j&&(h=a.apply(i,g));else{var c=new Rc;m||p||(k=c);var d=l-(c-k);0>=d?(cd(m),m=null,k=c,h=a.apply(i,g)):m||(m=kd(f,d))}return b!==l&&(n=kd(e,b)),h}}function uc(a){var b=wd.call(arguments,1);return kd(function(){a.apply(r,b)},1)}function vc(a,b){var c=wd.call(arguments,2);return kd(function(){a.apply(r,c)},b)}function wc(a,b){function c(){var d=c.cache,e=w+(b?b.apply(this,arguments):arguments[0]);return hd.call(d,e)?d[e]:d[e]=a.apply(this,arguments)}return c.cache={},c}function xc(a){var b,c;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}}function yc(a){return g(a,wd.call(arguments,1))}function zc(a){return g(a,wd.call(arguments,1),null,v)}function Ac(a,b,c){var d=!0,e=!0;c===!1?d=!1:qb(c)&&(d="leading"in c?c.leading:d,e="trailing"in c?c.trailing:e),c=m(),c.leading=d,c.maxWait=b,c.trailing=e;var f=tc(a,b,c);return o(c),f}function Bc(a,b){return function(){var c=[a];return id.apply(c,arguments),b.apply(this,c)}}function Cc(a){return null==a?"":Xc(a).replace(K,t)}function Dc(a){return a}function Ec(a){Jb(gb(a),function(b){var e=c[b]=a[b];c.prototype[b]=function(){var a=this.__wrapped__,b=[a];id.apply(b,arguments);var f=e.apply(c,b);return a&&"object"==typeof a&&a===f?this:new d(f)}})}function Fc(){return b._=_c,this}function Gc(a,b){null==a&&null==b&&(b=1),a=+a||0,null==b?(b=a,a=0):b=+b||0;var c=vd();return a%1||b%1?a+td(c*(b-a+parseFloat("1e-"+((c+"").length-1))),b):a+ed(c*(b-a+1))}function Hc(a,b){var c=a?a[b]:r;return pb(c)?a[b]():c}function Ic(a,b,d){var e=c.templateSettings;a||(a=""),d=Hd({},d,e);var f,g=Hd({},d.imports,e.imports),h=Dd(g),i=Cb(g),j=0,l=d.interpolate||J,m="__p += '",n=Wc((d.escape||J).source+"|"+l.source+"|"+(l===F?D:J).source+"|"+(d.evaluate||J).source+"|$","g");a.replace(n,function(b,c,d,e,g,h){return d||(d=e),m+=a.slice(j,h).replace(L,k),c&&(m+="' +\n__e("+c+") +\n'"),g&&(f=!0,m+="';\n"+g+";\n__p += '"),d&&(m+="' +\n((__t = ("+d+")) == null ? '' : __t) +\n'"),j=h+b.length,b}),m+="';\n";var o=d.variable,p=o;p||(o="obj",m="with ("+o+") {\n"+m+"\n}\n"),m=(f?m.replace(z,""):m).replace(A,"$1").replace(B,"$1;"),m="function("+o+") {\n"+(p?"":o+" || ("+o+" = {});\n")+"var __t, __p = '', __e = _.escape"+(f?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+m+"return __p\n}";var q="\n/*\n//@ sourceURL="+(d.sourceURL||"/lodash/template/source["+N++ +"]")+"\n*/";try{var s=Sc(h,"return "+m+q).apply(r,i)}catch(t){throw t.source=m,t}return b?s(b):(s.source=m,s)}function Jc(a,b,d){a=(a=+a)>-1?a:0;var e=-1,f=Pc(a);for(b=c.createCallback(b,d,1);++e<a;)f[e]=b(e);return f}function Kc(a){return null==a?"":Xc(a).replace(C,ab)}function Lc(a){var b=++u;return Xc(null==a?"":a)+b}function Mc(a,b){return b(a),a}function Nc(){return Xc(this.__wrapped__)}function Oc(){return this.__wrapped__}b=b?bb.defaults(a.Object(),b,bb.pick(a,M)):a;var Pc=b.Array,Qc=b.Boolean,Rc=b.Date,Sc=b.Function,Tc=b.Math,Uc=b.Number,Vc=b.Object,Wc=b.RegExp,Xc=b.String,Yc=b.TypeError,Zc=[],$c=Vc.prototype;Xc.prototype;var _c=b._,ad=Wc("^"+Xc($c.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),bd=Tc.ceil,cd=b.clearTimeout,dd=Zc.concat,ed=Tc.floor,fd=Sc.prototype.toString,gd=ad.test(gd=Vc.getPrototypeOf)&&gd,hd=$c.hasOwnProperty,id=Zc.push,jd=($c.propertyIsEnumerable,b.setImmediate),kd=b.setTimeout,ld=$c.toString,md=ad.test(md=ld.bind)&&md,nd=ad.test(nd=Vc.create)&&nd,od=ad.test(od=Pc.isArray)&&od,pd=b.isFinite,qd=b.isNaN,rd=ad.test(rd=Vc.keys)&&rd,sd=Tc.max,td=Tc.min,ud=b.parseInt,vd=Tc.random,wd=Zc.slice,xd=ad.test(b.attachEvent),yd=md&&!/\n|true/.test(md+xd),zd={};zd[P]=Pc,zd[Q]=Qc,zd[R]=Rc,zd[S]=Sc,zd[U]=Vc,zd[T]=Uc,zd[V]=Wc,zd[W]=Xc,d.prototype=c.prototype;var Ad=c.support={};Ad.fastBind=md&&!yd,c.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:F,variable:"",imports:{_:c}};var Bd=od,Cd=function(a){var b,c=a,d=[];if(!c)return d;if(!Y[typeof a])return d;for(b in c)hd.call(c,b)&&d.push(b);return d},Dd=rd?function(a){return qb(a)?rd(a):[]}:Cd,Ed={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Fd=ib(Ed),Gd=function(a,b,d){var e,f=a,g=f;if(!f)return g;var h=arguments,i=0,j="number"==typeof d?2:h.length;if(j>3&&"function"==typeof h[j-2])var k=c.createCallback(h[--j-1],h[j--],2);else j>2&&"function"==typeof h[j-1]&&(k=h[--j]);for(;++i<j;)if(f=h[i],f&&Y[typeof f])for(var l=-1,m=Y[typeof f]&&Dd(f),n=m?m.length:0;++l<n;)e=m[l],g[e]=k?k(g[e],f[e]):f[e];return g},Hd=function(a,b,c){var d,e=a,f=e;if(!e)return f;for(var g=arguments,h=0,i="number"==typeof c?2:g.length;++h<i;)if(e=g[h],e&&Y[typeof e])for(var j=-1,k=Y[typeof e]&&Dd(e),l=k?k.length:0;++j<l;)d=k[j],"undefined"==typeof f[d]&&(f[d]=e[d]);return f},Id=function(a,b,d){var e,f=a,g=f;if(!f)return g;if(!Y[typeof f])return g;b=b&&"undefined"==typeof d?b:c.createCallback(b,d);for(e in f)if(b(f[e],e,a)===!1)return g;return g},Jd=function(a,b,d){var e,f=a,g=f;if(!f)return g;if(!Y[typeof f])return g;b=b&&"undefined"==typeof d?b:c.createCallback(b,d);for(var h=-1,i=Y[typeof f]&&Dd(f),j=i?i.length:0;++h<j;)if(e=i[h],b(f[e],e,a)===!1)return g;return g},Kd=function(a){if(!a||ld.call(a)!=U)return!1;var b=a.valueOf,c="function"==typeof b&&(c=gd(b))&&gd(c);return c?a==c||gd(a)==c:$(a)},Ld=Hb,Md=Z(function Pd(a,b,c){for(var d=-1,e=a?a.length:0,f=[];++d<e;){var g=a[d];c&&(g=c(g,d,a)),Bd(g)?id.apply(f,b?g:Pd(g)):f.push(g)}return f}),Nd=Z(function(a,b,c){var d=-1,g=y(),h=a?a.length:0,i=[],k=!b&&h>=x&&g===e,m=c||k?l():i;if(k){var p=j(m);p?(g=f,m=p):(k=!1,m=c?m:(n(m),i))}for(;++d<h;){var q=a[d],r=c?c(q,d,a):q;(b?!d||m[m.length-1]!==r:g(m,r)<0)&&((c||k)&&m.push(r),i.push(q))}return k?(n(m.array),o(m)):c&&n(m),i});yd&&_&&"function"==typeof jd&&(uc=oc(jd,b));var Od=8==ud(H+"08")?ud:function(a,b){return ud(vb(a)?a.replace(I,""):a,b||0)};return c.after=nc,c.assign=Gd,c.at=Db,c.bind=oc,c.bindAll=pc,c.bindKey=qc,c.compact=Yb,c.compose=rc,c.countBy=Fb,c.createCallback=sc,c.debounce=tc,c.defaults=Hd,c.defer=uc,c.delay=vc,c.difference=Zb,c.filter=Hb,c.flatten=Md,c.forEach=Jb,c.forIn=Id,c.forOwn=Jd,c.functions=gb,c.groupBy=Kb,c.initial=bc,c.intersection=cc,c.invert=ib,c.invoke=Lb,c.keys=Dd,c.map=Mb,c.max=Nb,c.memoize=wc,c.merge=xb,c.min=Ob,c.omit=yb,c.once=xc,c.pairs=zb,c.partial=yc,c.partialRight=zc,c.pick=Ab,c.pluck=Pb,c.range=fc,c.reject=Sb,c.rest=gc,c.shuffle=Tb,c.sortBy=Wb,c.tap=Mc,c.throttle=Ac,c.times=Jc,c.toArray=Xb,c.transform=Bb,c.union=ic,c.uniq=Nd,c.unzip=jc,c.values=Cb,c.where=Ld,c.without=kc,c.wrap=Bc,c.zip=lc,c.zipObject=mc,c.collect=Mb,c.drop=gc,c.each=Jb,c.extend=Gd,c.methods=gb,c.object=mc,c.select=Hb,c.tail=gc,c.unique=Nd,Ec(c),c.chain=c,c.prototype.chain=function(){return this},c.clone=db,c.cloneDeep=eb,c.contains=Eb,c.escape=Cc,c.every=Gb,c.find=Ib,c.findIndex=$b,c.findKey=fb,c.has=hb,c.identity=Dc,c.indexOf=ac,c.isArguments=cb,c.isArray=Bd,c.isBoolean=jb,c.isDate=kb,c.isElement=lb,c.isEmpty=mb,c.isEqual=nb,c.isFinite=ob,c.isFunction=pb,c.isNaN=rb,c.isNull=sb,c.isNumber=tb,c.isObject=qb,c.isPlainObject=Kd,c.isRegExp=ub,c.isString=vb,c.isUndefined=wb,c.lastIndexOf=ec,c.mixin=Ec,c.noConflict=Fc,c.parseInt=Od,c.random=Gc,c.reduce=Qb,c.reduceRight=Rb,c.result=Hc,c.runInContext=q,c.size=Ub,c.some=Vb,c.sortedIndex=hc,c.template=Ic,c.unescape=Kc,c.uniqueId=Lc,c.all=Gb,c.any=Vb,c.detect=Ib,c.findWhere=Ib,c.foldl=Qb,c.foldr=Rb,c.include=Eb,c.inject=Qb,Jd(c,function(a,b){c.prototype[b]||(c.prototype[b]=function(){var b=[this.__wrapped__];return id.apply(b,arguments),a.apply(c,b)})}),c.first=_b,c.last=dc,c.take=_b,c.head=_b,Jd(c,function(a,b){c.prototype[b]||(c.prototype[b]=function(b,c){var e=a(this.__wrapped__,b,c);return null==b||c&&"function"!=typeof b?e:new d(e)})}),c.VERSION="1.3.1",c.prototype.toString=Nc,c.prototype.value=Oc,c.prototype.valueOf=Oc,Jb(["join","pop","shift"],function(a){var b=Zc[a];c.prototype[a]=function(){return b.apply(this.__wrapped__,arguments)}}),Jb(["push","reverse","sort","unshift"],function(a){var b=Zc[a];c.prototype[a]=function(){return b.apply(this.__wrapped__,arguments),this}}),Jb(["concat","slice","splice"],function(a){var b=Zc[a];c.prototype[a]=function(){return new d(b.apply(this.__wrapped__,arguments))}}),c}var r,s=[],t=[],u=0,v={},w=+new Date+"",x=75,y=40,z=/\b__p \+= '';/g,A=/\b(__p \+=) '' \+/g,B=/(__e\(.*?\)|\b__t\)) \+\n'';/g,C=/&(?:amp|lt|gt|quot|#39);/g,D=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,E=/\w*$/,F=/<%=([\s\S]+?)%>/g,G=(G=/\bthis\b/)&&G.test(q)&&G,H=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",I=RegExp("^["+H+"]*0+(?=.$)"),J=/($^)/,K=/[&<>"']/g,L=/['\n\r\t\u2028\u2029\\]/g,M=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setImmediate","setTimeout"],N=0,O="[object Arguments]",P="[object Array]",Q="[object Boolean]",R="[object Date]",S="[object Function]",T="[object Number]",U="[object Object]",V="[object RegExp]",W="[object String]",X={};X[S]=!1,X[O]=X[P]=X[Q]=X[R]=X[T]=X[U]=X[V]=X[W]=!0;var Y={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},Z={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},$=Y[typeof c]&&c,_=Y[typeof b]&&b&&b.exports==$&&b,ab=Y[typeof d]&&d;!ab||ab.global!==ab&&ab.window!==ab||(a=ab);var bb=q();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(a._=bb,define(function(){return bb})):$&&!$.nodeType?_?(_.exports=bb)._=bb:$._=bb:a._=bb}(this)},{}],2:[function(a,b,c){"use strict";c.intFromBoolean=function(a){return a?1:0},c.booleanFromInt=function(a){return null===a?!1:a>0}},{}],3:[function(a,b){"use strict";var c=a("../janicek/core"),d=c.def,e=function(a,b,f,g,h,i){var j={a:d(a,1),b:d(b,0),c:d(f,0),d:d(g,1),tx:d(h,0),ty:d(i,0),clone:function(){return e(j.a,j.b,j.c,j.d,j.tx,j.ty)},createGradientBox:function(a,b,d,e,f){if(j.a=a/1638.4,j.d=b/1638.4,c.isUndefinedOrNull(d)||0===d)j.b=j.c=0;else{var g=Math.cos(d),h=Math.sin(d);j.b=h*j.d,j.c=-h*j.a,j.a*=g,j.d*=g}j.tx=c.isUndefinedOrNull(e)?a/2:e+a/2,j.ty=c.isUndefinedOrNull(f)?b/2:f+b/2},setRotation:function(a,b){var d=c.isUndefinedOrNull(b)?1:b;j.a=Math.cos(a)*d,j.c=Math.sin(a)*d,j.b=-j.c,j.d=j.a},invert:function(){var a=j.a*j.d-j.b*j.c;if(0===a)j.a=j.b=j.c=j.d=0,j.tx=-j.tx,j.ty=-j.ty;else{a=1/a;var b=j.d*a;j.d=j.a*a,j.a=b,j.b*=-a,j.c*=-a;var c=-j.a*j.tx-j.c*j.ty;j.ty=-j.b*j.tx-j.d*j.ty,j.tx=c}return this},transformPoint:function(a){return{x:a.x*j.a+a.y*j.c+j.tx,y:a.x*j.b+a.y*j.d+j.ty}},translate:function(a,b){j.tx+=a,j.ty+=b},rotate:function(a){var b=Math.cos(a),c=Math.sin(a),d=j.a*b-j.b*c;j.b=j.a*c+j.b*b,j.a=d;var e=j.c*b-j.d*c;j.d=j.c*c+j.d*b,j.c=e;var f=j.tx*b-j.ty*c;j.ty=j.tx*c+j.ty*b,j.tx=f},scale:function(a,b){j.a*=a,j.b*=b,j.c*=a,j.d*=b,j.tx*=a,j.ty*=b},concat:function(a){var b=j.a*a.a+j.b*a.c;j.b=j.a*a.b+j.b*a.d,j.a=b;var c=j.c*a.a+j.d*a.c;j.d=j.c*a.b+j.d*a.d,j.c=c;var d=j.tx*a.a+j.ty*a.c+a.tx;j.ty=j.tx*a.b+j.ty*a.d+a.ty,j.tx=d},mult:function(a){var b=e();return b.a=j.a*a.a+j.b*a.c,b.b=j.a*a.b+j.b*a.d,b.c=j.c*a.a+j.d*a.c,b.d=j.c*a.b+j.d*a.d,b.tx=j.tx*a.a+j.ty*a.c+a.tx,b.ty=j.tx*a.b+j.ty*a.d+a.ty,b},identity:function(){j.a=1,j.b=0,j.c=0,j.d=1,j.tx=0,j.ty=0},toMozString:function(){var a="matrix(";return a+=j.a+", ",a+=j.b+", ",a+=j.c+", ",a+=j.d+", ",a+=j.tx+"px, ",a+=j.ty+"px)"},toString:function(){var a="matrix(";return a+=j.a+", ",a+=j.b+", ",a+=j.c+", ",a+=j.d+", ",a+=j.tx+", ",a+=j.ty+")"}};return j};b.exports=e},{"../janicek/core":10}],4:[function(a,b){"use strict";b.exports={distanceFromOrigin:function(a){return Math.sqrt(a.x*a.x+a.y*a.y)},distance:function(a,b){return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2))},interpolate:function(a,b,c){return{x:(a.x-b.x)*c+b.x,y:(a.y-b.y)*c+b.y}},normalize:function(a,b){if(0===a.x&&0===a.y)a.x=b;else{var c=b/Math.sqrt(a.x*a.x+a.y*a.y);a.x*=c,a.y*=c}},add:function(a,b){return{x:b.x+a.x,y:b.y+a.y}},subtract:function(a,b){return{x:a.x-b.x,y:a.y-b.y}},hash:function(a){return a.x+","+a.y}}},{}],5:[function(a,b){"use strict";b.exports=function(a,b,c,d){return{x:a||0,y:b||0,width:c||0,height:d||0}},b.exports.core=function(a){return{left:function(){return a.x},right:function(){return a.x+a.width},top:function(){return a.y},bottom:function(){return a.y+a.height}}}},{}],6:[function(a,b){"use strict";var c=a("../janicek/core").def,d=function(a,b,d,e){this.w=c(e,0),this.x=c(a,0),this.y=c(b,0),this.z=c(d,0)},e=function(a,b,c,e){return new d(a,b,c,e)};d.prototype={getLength:function(){return Math.abs(e.distance(this,e()))},get length(){return this.getLength()},getLengthSquared:function(){return this.length*this.length},get lengthSquared(){return this.getLengthSquared()},add:function(a){return e(this.x+a.x,this.y+a.y,this.z+a.z)},clone:function(){return e(this.x,this.y,this.z,this.w)},crossProduct:function(a){return e(this.y*a.z-this.z*a.y,this.z*a.x-this.x*a.z,this.x*a.y-this.y*a.x,1)},decrementBy:function(a){this.x-=a.x,this.y-=a.y,this.z-=a.z},dotProduct:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},equals:function(a,b){return b=c(b,!1),this.x===a.x&&this.y===a.y&&this.z===a.z&&(!b||this.w===a.w)},incrementBy:function(a){this.x+=a.x,this.y+=a.y,this.z+=a.z},nearEquals:function(a,b,d){return d=c(d,!1),Math.abs(this.x-a.x)<b&&Math.abs(this.y-a.y)<b&&Math.abs(this.z-a.z)<b&&(!d||Math.abs(this.w-a.w)<b)},negate:function(){this.x*=-1,this.y*=-1,this.z*=-1},normalize:function(){var a=this.length;return 0!==a&&(this.x/=a,this.y/=a,this.z/=a),a},project:function(){this.x/=this.w,this.y/=this.w,this.z/=this.w},scaleBy:function(a){this.x*=a,this.y*=a,this.z*=a},subtract:function(a){return e(this.x-a.x,this.y-a.y,this.z-a.z)},toString:function(){return"Vector3D("+this.x+", "+this.y+", "+this.z+")"}},e.angleBetween=function(a,b){var c=a.clone();c.normalize();var d=b.clone();return d.normalize(),Math.acos(c.dotProduct(d))},e.distance=function(a,b){var c=b.x-a.x,d=b.y-a.y,e=b.z-a.z;return Math.sqrt(c*c+d*d+e*e)},Object.defineProperties(e,{X_AXIS:{get:function(){return e(1,0,0)}}}),Object.defineProperties(e,{Y_AXIS:{get:function(){return e(0,1,0)}}}),Object.defineProperties(e,{Z_AXIS:{get:function(){return e(0,0,1)}}}),b.exports=e},{"../janicek/core":10}],7:[function(a,b,c){"use strict";function d(){var a=$(y.S_imageThreshold).val(),b=v.displayColors.OCEAN,c=v.displayColors.GRASSLAND;if($(y.S_invertImage).is(":checked")){var d=b;b=c,c=d}var e=l.makeAverageThresholdImageData(l.getImageData(i),a,b,c),f=l.makeImageDataUrlFromImageData(e);$(y.S_imageThumb).attr("src",f)}function e(a){var b=c.getContext();switch(m.graphicsReset(b,a.map.SIZE.width,a.map.SIZE.height,v.displayColors),$(y.S_view).val()){case"debug polygons":m.renderDebugPolygons(b,a.map,v.displayColors);break;case"smooth":m.renderPolygons(b,v.displayColors,null,m.colorWithSlope,a.map,a.noisyEdges),m.renderEdges(b,v.displayColors,a.map,a.noisyEdges,a.lava,$(y.S_viewRivers).is(":checked"))}$(y.S_viewEdges).is(":checked")&&m.renderAllEdges(b,n.rgba(208,208,208,.25),a.map,a.noisyEdges),$(y.S_viewRoads).is(":checked")&&m.renderRoads(b,a.map,a.roads,v.displayColors),$(y.S_viewBridges).is(":checked")&&m.renderBridges(b,a.map,a.roads,v.displayColors),$(y.S_viewWatersheds).is(":checked")&&m.renderWatersheds(b,a.map,a.watersheds),$(y.S_addNoise).is(":checked")&&l.addNoiseToCanvas(b,666,10,!0)}function f(){var a=document.getElementById(y.ID_map);return null===a&&(a=document.createElement("canvas"),a.id=y.ID_map,document.body.appendChild(a)),a}function g(a){return k(a).isNumber()?k(a).parseInt():Math.abs(s.stringToSeed(a))}function h(){c.initializeUi(),j=c.generate(),a("./janicek/perf").traceCounters()}var i,j,k=a("lodash"),l=a("./janicek/canvas"),m=a("./voronoimap/canvas-render"),n=a("./janicek/html-color"),o=a("./voronoimap/island-shape"),p=a("./voronoimap/lava"),q=a("./voronoimap/map"),r=a("./voronoimap/noisy-edges"),s=a("./janicek/pseudo-random-number-generators"),t=a("./voronoimap/roads"),u=a("./janicek/string"),v=a("./voronoimap/style"),w=a("./voronoimap/watersheds"),x=a("./janicek/timer")(),y={ID_map:"map",S_addNoise:"#addNoise",S_edgeNoise:"#edgeNoise",S_fields:"#fields",S_fieldset:"#fieldset",S_generate:"#generate",S_height:"#height",S_imageFile:"#imageFile",S_imageThreshold:"#imageThreshold",S_imageThumb:"#imageThumb",S_invertImage:"#invertImage",S_islandFactor:"#islandFactor",S_islandShape:"#islandShape",S_lakeThreshold:"#lakeThreshold",S_lloydIterations:"#lloydIterations",S_map:"#map",S_numberOfLands:"#numberOfLands",S_numberOfPoints:"#numberOfPoints",S_oceanRatio:"#oceanRatio",S_random:"#random",S_riverChance:"#riverChance",S_roadElevationThresholds:"#roadElevationThresholds",S_seed:"#seed",S_shapeRandom:"#shapeRandom",S_shapeSeed:"#shapeSeed",S_toggle:"#toggle",S_view:"#view",S_viewBridges:"#viewBridges",S_viewEdges:"#viewEdges",S_viewRivers:"#viewRivers",S_viewRoads:"#viewRoads",S_viewWatersheds:"#viewWatersheds",S_width:"#width"};c.initializeUi=function(){i=new Image,i.onload=function(){$(y.S_imageThumb).attr("src",i.src),d()},i.src="world-map.jpg",$(y.S_random).click(function(){$(y.S_seed).val(String(s.makeRandomSeed()))}),$(y.S_shapeRandom).click(function(){$(y.S_shapeSeed).val(String(s.makeRandomSeed()))}),$(y.S_islandShape).change(function(){switch($([y.S_islandFactor,y.S_oceanRatio,y.S_shapeSeed,y.S_imageFile,y.S_imageThumb,y.S_invertImage,y.S_imageThreshold].toString()).parent().hide(),$(y.S_islandShape).val()){case"bitmap":$([y.S_imageFile,y.S_imageThumb,y.S_invertImage,y.S_imageThreshold].toString()).parent().show();break;case"noise":$(y.S_shapeSeed).parent().show();break;
case"perlin":$([y.S_oceanRatio,y.S_shapeSeed].toString()).parent().show();break;case"radial":$([y.S_islandFactor,y.S_shapeSeed].toString()).parent().show()}}),$(y.S_imageFile).change(function(){console.log("file changed");var a=$(y.S_imageFile).get()[0],b=a.files;if(1===b.length){var c=b[0];u(c.type).startsWith("image")&&l.loadFileIntoImage(c,i)}}),$([y.S_invertImage,y.S_imageThreshold].toString()).change(function(){d()}),0===$(y.S_width).val().length&&$(y.S_width).val(String(window.innerWidth)),0===$(y.S_height).val().length&&$(y.S_height).val(String(window.innerHeight)),$(y.S_view).change(function(){switch($(y.S_view).val()){case"debug polygons":$(y.S_addNoise).removeAttr("checked");break;case"smooth":$(y.S_addNoise).attr("checked","true")}}),$([y.S_view,y.S_viewRivers,y.S_viewRoads,y.S_viewBridges,y.S_viewWatersheds,y.S_viewEdges,y.S_addNoise].toString()).change(function(){e(j)}),$(y.S_viewRoads).change(function(){$(y.S_roadElevationThresholds).parent().toggle()}),$(y.S_generate).click(function(){j=c.generate()}),$(y.S_toggle).click(function(){var a=$(y.S_fields);a.toggle(500,function(){$(y.S_toggle).text(a.is(":visible")?"hide":"show")})})},c.getContext=function(){var a=document.getElementById(y.ID_map);return a.getContext("2d")},c.generate=function(){x.start();var a={map:null,noisyEdges:null,roads:null,watersheds:null,lava:null},b=f();b.width=k($(y.S_width).val()).parseInt(),b.height=k($(y.S_height).val()).parseInt(),a.map=q({width:b.width+0,height:b.height+0});var c=g($(y.S_seed).val()),d=g($(y.S_shapeSeed).val()),h=$(y.S_islandShape).val();switch(h){case"bitmap":var j=l.getImageData(i);console.log($(y.S_imageThreshold).val());var m=l.makeAverageThresholdBitmap(j,$(y.S_imageThreshold).val());$(y.S_invertImage).is(":checked")&&(m=m.invertBitmap()),a.map.newIsland(o.makeBitmap(m),c);break;case"blob":a.map.newIsland(o.makeBlob(),c);break;case"noise":a.map.newIsland(o.makeNoise(d),c);break;case"perlin":a.map.newIsland(o.makePerlin(d,$(y.S_oceanRatio).val()),c);break;case"radial":a.map.newIsland(o.makeRadial(d,$(y.S_islandFactor).val()),c);break;case"square":a.map.newIsland(o.makeSquare(),c)}a.watersheds=w(),a.noisyEdges=r(),a.lava=p(),a.roads=t();var n=$(y.S_numberOfLands).val();k(n).isNumber()?q.tryMutateMapPointsToGetNumberLands(a.map,n,30,2*n):(a.map.go0PlacePoints($(y.S_numberOfPoints).val()),a.map.go1ImprovePoints($(y.S_lloydIterations).val()),a.map.go2BuildGraph(),a.map.go3AssignElevations($(y.S_lakeThreshold).val())),a.map.go4AssignMoisture($(y.S_riverChance).val()),a.map.go5DecorateMap();var s=$(y.S_roadElevationThresholds).val().split(",");return a.roads.createRoads(a.map,s),a.watersheds.createWatersheds(a.map),a.noisyEdges.buildNoisyEdges(a.map,a.lava,c,$(y.S_edgeNoise).val()),x.log("generate"),e(a),x.log("render"),a},h()},{"./janicek/canvas":9,"./janicek/html-color":12,"./janicek/perf":14,"./janicek/pseudo-random-number-generators":16,"./janicek/string":17,"./janicek/timer":18,"./voronoimap/canvas-render":39,"./voronoimap/island-shape":43,"./voronoimap/lava":44,"./voronoimap/map":45,"./voronoimap/noisy-edges":46,"./voronoimap/roads":47,"./voronoimap/style":48,"./voronoimap/watersheds":49,lodash:1}],8:[function(a,b){"use strict";var c=a("./core"),d=a("lodash");b.exports=function(a){return a=c.def(a,[]),{value:a,get:function(b,c){return d(a[c]).isUndefined()?null:a[c][b]},set:function(b,d,e){return a[d]=c.def(a[d],[]),a[d][b]=e,a},getIndices:function(a,b,d){return d=c.def(d,1),{x:a/d%b,y:c.toInt(a/d/b)}},foreachY:function(b){d(a).each(function(a){d(a).isUndefined()||b(a)})},foreachXY:function(b){var c;for(c=0;c<a.length;c++)if(!d(a[c]).isUndefined()){var e;for(e=0;e<a[c].length;e++)if(!d(a[c][e]).isUndefined()){var f=a[c][e];null!==f&&b(e,c,f)}}},any:function(b){var c;for(c=0;c<a.length;c++)if(!d(a[c]).isUndefined()){var e;for(e=0;e<a[c].length;e++)if(!d(a[c][e]).isUndefined()){var f=a[c][e];if(null!==f&&b(f))return{x:e,y:c}}}return null},dimensions:function(){var b=a.length,c=0;return this.foreachY(function(a){c=Math.max(c,a.length)}),{x:c,y:b}}}}},{"./core":10,lodash:1}],9:[function(a,b,c){"use strict";var d=a("./core"),e=a("./html-color"),f=a("./math"),g=a("./pseudo-random-number-generators"),h=4,i=0,j=1,k=2,l=3;c.renderCanvasPixelArray=function(a,b){for(var c,e=a.data,f=0;f<d.toInt(e.length/h);f++){c=f*h;var g=b(c,e[c+i],e[c+j],e[c+k],e[c+l]);null!==g&&(null!==g.red&&(e[c+i]=g.red),null!==g.green&&(e[c+j]=g.green),null!==g.blue&&(e[c+k]=g.blue),null!==g.alpha&&(e[c+l]=g.alpha))}},c.addNoise=function(a,b,e,h,i,j,k,l){h=d.def(h,!1),i=d.def(i,!0),j=d.def(j,!0),k=d.def(k,!0),l=d.def(l,!1);var m=g.randomGenerator(b,g.nextParkMiller);e=f.clamp(e,1,255);var n;return c.renderCanvasPixelArray(a,function(a,b,c,d,f){n=g.toIntRange(m(),-e,e);var o={red:null,green:null,blue:null,alpha:null};return i&&(o.red=b+n),j&&(o.green=c+(h?n:g.toIntRange(m(),-e,e))),k&&(o.blue=d+(h?n:g.toIntRange(m(),-e,e))),l&&(o.alpha=f+g.toIntRange(m(),-e,e)),o}),a},c.addNoiseToCanvas=function(a,b,e,f,g,h,i,j){f=d.def(f,!1),g=d.def(g,!0),h=d.def(h,!0),i=d.def(i,!0),j=d.def(j,!1);var k=a.getImageData(0,0,a.canvas.width,a.canvas.height);k=c.addNoise(k,b,e,f,g,h,i,j),a.putImageData(k,0,0)},c.loadFileIntoImage=function(a,b){var c=new FileReader;c.onload=function(a){b.src=a.target.result},c.readAsDataURL(a)},c.getImageData=function(a){var b=document.createElement("canvas");b.width=a.width,b.height=a.height;var c=b.getContext("2d");c.drawImage(a,0,0);var d=c.getImageData(0,0,b.width,b.height);return d},c.makeImageDataUrlFromImageData=function(a){var b=document.createElement("canvas");return b.width=a.width,b.height=a.height,b.getContext("2d").putImageData(a,0,0),b.toDataURL()},c.makeAverageThresholdImageData=function(a,b,g,h,i){i=d.def(i,1);var j=e.colorFraction(i);return c.renderCanvasPixelArray(a,function(a,c,d,i){var k=f.average([c,d,i])>=b?h:g;return{red:e.getRedComponent(k),green:e.getGreenComponent(k),blue:e.getBlueComponent(k),alpha:j}}),a}},{"./core":10,"./html-color":12,"./math":13,"./pseudo-random-number-generators":16}],10:[function(a,b){"use strict";var c=a("lodash");b.exports={def:function(a,b){return c.isUndefined(a)?b:a},toInt:function(a){return 0|a},coalesce:function(){return c.find(arguments,function(a){return!c.isNull(a)&&!c.isUndefined(a)})},isUndefinedOrNull:function(a){return c.isUndefined(a)||c.isNull(a)}}},{lodash:1}],11:[function(a,b,c){"use strict";c.djb2=function(a){var b,c=5381;for(b=0;b<a.length;b++)c=(c<<5)+c+a.charCodeAt(b);return c},c.sdbm=function(a){var b,c=0;for(b=0;b<a.length;b++)c=a.charCodeAt(b)+(c<<6)+(c<<16)-c;return c},c.javaHashCode=function(a){var b=0;if(0===a.length)return b;for(var c=0;c<a.length;c++)b=(b<<5)-b+a.charCodeAt(c),b&=b;return b}},{}],12:[function(a,b,c){"use strict";var d=a("./core");c.MAX_COLOR_COMPONENT=255,c.getRedComponent=function(a){return 255&a>>16},c.getGreenComponent=function(a){return 255&a>>8},c.getBlueComponent=function(a){return 255&a},c.interpolateColor=function(a,b,c){var e=d.toInt((1-c)*(a>>16)+c*(b>>16)),f=d.toInt((1-c)*(255&a>>8)+c*(255&b>>8)),g=d.toInt((1-c)*(255&a)+c*(255&b));return e>255&&(e=255),f>255&&(f=255),g>255&&(g=255),e<<16|f<<8|g},c.colorFraction=function(a){return d.toInt(c.MAX_COLOR_COMPONENT*a)},c.intToHexColor=function(a){return"#"+("00000"+a.toString(16).toUpperCase()).substr(-6)},c.rgb=function(a,b,c){return"rgb("+a+","+b+","+c+")"},c.rgba=function(a,b,c,d){return"rgba("+a+","+b+","+c+","+d+")"},c.rgbF=function(a,b,c){return"rgb("+100*a+"%,"+100*b+"%,"+100*c+"%)"},c.rgbaF=function(a,b,c,d){return"rgba("+100*a+"%,"+100*b+"%,"+100*c+"%,"+d+")"},c.hsl=function(a,b,c){return"hsl("+a+","+100*b+"%,"+100*c+"%)"},c.hsla=function(a,b,c,d){return"hsla("+a+","+100*b+"%,"+100*c+"%,"+d+")"}},{"./core":10}],13:[function(a,b,c){"use strict";var d=a("lodash");c.average=function(a){return d.reduce(a,function(a,b){return a+b})/d.size(a)},c.clamp=function(a,b,c){var d=Math.min(b,c),e=Math.max(b,c);return d>a?d:a>e?e:a}},{lodash:1}],14:[function(a,b,c){"use strict";var d=a("lodash");c.counters={},c.bumpCounter=function(a){c.counters[a]||(c.counters[a]=0),c.counters[a]++},c.traceCounters=function(){d.each(c.counters,function(a,b){console.log(b,a)})}},{lodash:1}],15:[function(a,b,c){"use strict";var d=a("./array2d"),e=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180,151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];c.makePerlinNoise=function(a,b,c,f,g,h,i,j){h=h||666,i=i||4,j=j||.5;var k,l,m,n=1/64,o=h=16807*h%2147483647,p=h=16807*h%2147483647,q=h=16807*h%2147483647,r=[],s=[],t=0;for(m=0;i>m;m++)k=Math.pow(2,m),l=Math.pow(j,m),t+=l,r.push(k),s.push(l);t=1/t;var u=d([]),v=c*n+o;f=f*n+p,g=g*n+q;var w;for(w=0;b>w;w++){c=v;var x;for(x=0;a>x;x++){var y=0;for(m=0;i>m;m++){var z=r[m],A=s[m],B=c*z,C=f*z,D=g*z,E=B-B%1,F=C-C%1,G=D-D%1,H=255&E,I=255&F,J=255&G;B-=E,C-=F,D-=G;var K=B*B*B*(B*(6*B-15)+10),L=C*C*C*(C*(6*C-15)+10),M=D*D*D*(D*(6*D-15)+10),N=e[H]+I,O=e[N]+J,P=e[N+1]+J,Q=e[H+1]+I,R=e[Q]+J,S=e[Q+1]+J,T=B-1,U=C-1,V=D-1,W=15&e[S+1],X=(0===(1&W)?8>W?T:U:8>W?-T:-U)+(0===(2&W)?4>W?U:12===W?T:V:4>W?-U:14===W?-T:-V);W=15&e[P+1];var Y=(0===(1&W)?8>W?B:U:8>W?-B:-U)+(0===(2&W)?4>W?U:12===W?B:V:4>W?-U:14===W?-B:-V);W=15&e[R+1];var Z=(0===(1&W)?8>W?T:C:8>W?-T:-C)+(0===(2&W)?4>W?C:12===W?T:V:4>W?-C:14===W?-T:-V);W=15&e[O+1];var $=(0===(1&W)?8>W?B:C:8>W?-B:-C)+(0===(2&W)?4>W?C:12===W?B:V:4>W?-C:14===W?-B:-V);W=15&e[S];var _=(0===(1&W)?8>W?T:U:8>W?-T:-U)+(0===(2&W)?4>W?U:12===W?T:D:4>W?-U:14===W?-T:-D);W=15&e[P];var ab=(0===(1&W)?8>W?B:U:8>W?-B:-U)+(0===(2&W)?4>W?U:12===W?B:D:4>W?-U:14===W?-B:-D);W=15&e[R];var bb=(0===(1&W)?8>W?T:C:8>W?-T:-C)+(0===(2&W)?4>W?C:12===W?T:D:4>W?-C:14===W?-T:-D);W=15&e[O];var cb=(0===(1&W)?8>W?B:C:8>W?-B:-C)+(0===(2&W)?4>W?C:12===W?B:D:4>W?-C:14===W?-B:-D);Y+=K*(X-Y),$+=K*(Z-$),ab+=K*(_-ab),cb+=K*(bb-cb),$+=L*(Y-$),cb+=L*(ab-cb),y+=(cb+M*($-cb))*A}var db=128*(y*t+1);u.set(x,w,4278190080|db<<16|db<<8|db),c+=n}f+=n}return u.value}},{"./array2d":8}],16:[function(a,b,c){"use strict";var d=a("./hash"),e=2147483647,f=16807;c.makeRandomSeed=function(){return Math.floor(Math.random()*e)},c.nextParkMiller=function(a){return a*f%e},c.nextParkMiller31=function(a){var b=16807*(65535&a),c=16807*(a>>>16);return b+=(32767&c)<<16,b+=c>>>15,b>2147483647&&(b-=2147483647),b},c.nextLCG=function(a){return(1103515245*a+12345)%e},c.toFloat=function(a){return a/e},c.toBool=function(a){return c.toFloat(a)>.5},c.toFloatRange=function(a,b,d){return b+(d-b)*c.toFloat(a)},c.toIntRange=function(a,b,d){return Math.round(b-.4999+(d+.4999-(b-.4999))*c.toFloat(a))},c.stringToSeed=function(a){return d.djb2(a)%e},c.randomGenerator=function(a,b){return function(){return a=b(a)}}},{"./hash":11}],17:[function(a,b){"use strict";b.exports=function(a){return{startsWith:function(b){return 0===a.indexOf(b)}}}},{}],18:[function(a,b){"use strict";b.exports=function(){var a,b;return{start:function(){a=b=Date.now()},log:function(c){var d=Date.now();console.log(c,d-b,d-a),b=d}}}},{}],19:[function(a,b){"use strict";b.exports={TOP:1,BOTTOM:2,LEFT:4,RIGHT:8,check:function(b,c){c=a("../../as3/rectangle").core(c);var d=0;return b.x===c.left()&&(d|=this.LEFT),b.x===c.right()&&(d|=this.RIGHT),b.y===c.top()&&(d|=this.TOP),b.y===c.bottom()&&(d|=this.BOTTOM),d}}},{"../../as3/rectangle":5}],20:[function(a,b){"use strict";b.exports={vertex:"vertex",site:"site"}},{}],21:[function(a,b){"use strict";var c=a("lodash");b.exports={delaunayLinesForEdges:function(a){var b=[];return c(a).each(function(a){b.push(a.delaunayLine())}),b},selectEdgesForSitePoint:function(a,b){return c(b).filter(function(b){return null!==b.leftSite&&b.leftSite.coord===a||null!==b.rightSite&&b.rightSite.coord===a})},selectNonIntersectingEdges:function(a,b){if(null===a)return b;var d={x:0,y:0};return c(b).filter(function(b){var c=b.makeDelaunayLineBmp(),e=!a.hitTest(d,1,c,d,1);return c.dispose(),e})},visibleLineSegments:function(b){var d=a("./lr"),e=a("../geom/line-segment"),f=[];return c(b).each(function(a){if(a.visible){var b=a.clippedEnds[d.LEFT],c=a.clippedEnds[d.RIGHT];f.push(e(b,c))}}),f}}},{"../geom/line-segment":35,"./lr":28,lodash:1}],22:[function(a,b){"use strict";var c=a("./halfedge"),d=a("./edge");b.exports=function(a,b,e){function f(a){var b;return 0>a||a>=j?null:(b=k[a],null!==b&&b.edge===d.DELETED?(k[a]=null,null):b)}var g={},h=0,i=0,j=0,k=[],l=null;g.getLeftEnd=function(){return l},Object.defineProperties(g,{leftEnd:{get:function(){return g.getLeftEnd()}}});var m=null;return g.getRightEnd=function(){return m},Object.defineProperties(g,{rightEnd:{get:function(){return g.getRightEnd()}}}),g.dispose=function(){for(var a,b=l;b!==m;)a=b,b=b.edgeListRightNeighbor,a.dispose();l=null,m.dispose(),m=null;var c;for(c=0;j>c;c++)k[c]=null;k=null},g.insert=function(a,b){b.edgeListLeftNeighbor=a,b.edgeListRightNeighbor=a.edgeListRightNeighbor,a.edgeListRightNeighbor.edgeListLeftNeighbor=b,a.edgeListRightNeighbor=b},g.remove=function(a){a.edgeListLeftNeighbor.edgeListRightNeighbor=a.edgeListRightNeighbor,a.edgeListRightNeighbor.edgeListLeftNeighbor=a.edgeListLeftNeighbor,a.edge=d.DELETED,a.edgeListLeftNeighbor=a.edgeListRightNeighbor=null},g.edgeListLeftNeighbor=function(a){var b,c;if(b=(a.x-i)/h*j,0>b&&(b=0),b>=j&&(b=j-1),c=f(b),null===c)for(var d=1;;){if(null!==(c=this.getHash(b-d)))break;if(null!==(c=this.getHash(b+d)))break;d++}if(c===this.getLeftEnd()||c!==this.getRightEnd()&&c.isLeftOf(a)){do c=c.edgeListRightNeighbor;while(c!==this.getRightEnd()&&c.isLeftOf(a));c=c.edgeListLeftNeighbor}else do c=c.edgeListLeftNeighbor;while(c!==this.getLeftEnd()&&!c.isLeftOf(a));return b>0&&j-1>b&&(k[b]=c),c},i=a,h=b,j=2*e,k=[],l=c.createDummy(),m=c.createDummy(),l.edgeListLeftNeighbor=null,l.edgeListRightNeighbor=m,m.edgeListLeftNeighbor=l,m.edgeListRightNeighbor=null,k[0]=l,k[j-1]=m,g}},{"./edge":24,"./halfedge":26}],23:[function(a,b){"use strict";var c=a("./criterion"),d=a("./lr"),e=a("./vertex"),f=function(a,b){if(b!==c.vertex&&b!==c.site)throw"Edges: criterion must be Vertex or Site";this.edges=[],this.edgeOrientations=[],a.length>0&&(this.edges=this._reorderEdges(a,b))};f.prototype={edges:null,edgeOrientations:null,dispose:function(){this.edges=null,this.edgeOrientations=null},_reorderEdges:function(a,b){var f,g,h=a.length,i=[],j=0,k=[];f=0,g=a[f],k.push(g),this.edgeOrientations.push(d.LEFT);var l,m;if(b===c.vertex?(l=g.leftVertex,m=g.rightVertex):(l=g.leftSite,m=g.rightSite),l===e.VERTEX_AT_INFINITY||m===e.VERTEX_AT_INFINITY)return[];for(i[f]=!0,++j;h>j;)for(f=1;h>f;f++)if(!i[f]){g=a[f];var n,o;if(b===c.vertex?(n=g.leftVertex,o=g.rightVertex):(n=g.leftSite,o=g.rightSite),n===e.VERTEX_AT_INFINITY||o===e.VERTEX_AT_INFINITY)return[];n===m?(m=o,this.edgeOrientations.push(d.LEFT),k.push(g),i[f]=!0):o===l?(l=n,this.edgeOrientations.unshift(d.LEFT),k.unshift(g),i[f]=!0):n===l?(l=o,this.edgeOrientations.unshift(d.RIGHT),k.unshift(g),i[f]=!0):o===m&&(m=n,this.edgeOrientations.push(d.RIGHT),k.push(g),i[f]=!0),i[f]&&++j}return k}},b.exports=function(a,b){return new f(a,b)}},{"./criterion":20,"./lr":28,"./vertex":32}],24:[function(a,b,c){"use strict";function d(){var a;return i.length>0?(a=i.pop(),a.init()):a=new c.Edge,a}var e=a("../geom/line-segment"),f=a("./lr"),g=a("../../as3/point-core"),h=a("../../as3/rectangle"),i=[],j=0;c.Edge=function(){this._edgeIndex=j++,this.init()},c.Edge.prototype={_delaunayLineBmp:null,getDelaunayLineBmp:function(){return null===this._delaunayLineBmp&&(this._delaunayLineBmp=this.makeDelaunayLineBmp()),this._delaunayLineBmp},get delaunayLineBmp(){return this.getDelaunayLineBmp()},makeDelaunayLineBmp:function(){throw"unimplemented"},delaunayLine:function(){return e(this.leftSite.coord,this.rightSite.coord)},voronoiEdge:function(){return this.visible?e(this.clippedEnds[f.LEFT],this.clippedEnds[f.RIGHT]):e(null,null)},a:null,b:null,c:null,leftVertex:null,rightVertex:null,vertex:function(a){return a===f.LEFT?this.leftVertex:this.rightVertex},setVertex:function(a,b){a===f.LEFT?this.leftVertex=b:this.rightVertex=b},isPartOfConvexHull:function(){return null===this.leftVertex||null===this.rightVertex},sitesDistance:function(){return g.distance(this.leftSite.coord,this.rightSite.coord)},clippedEnds:null,get visible(){return null!==this.clippedEnds},leftSite:null,rightSite:null,site:function(a){return a===f.LEFT?this.leftSite:this.rightSite},_edgeIndex:0,dispose:function(){null!==this._delaunayLineBmp&&(this._delaunayLineBmp.dispose(),this._delaunayLineBmp=null),this.leftVertex=null,this.rightVertex=null,null!==this.clippedEnds&&(this.clippedEnds[f.LEFT]=null,this.clippedEnds[f.RIGHT]=null,this.clippedEnds=null),this.leftSite=null,this.rightSite=null,i.push(this)},toString:function(){return"Edge "+this._edgeIndex+"; sites "+this.leftSite+", "+this.rightSite+"; endVertices "+(null!==this.leftVertex?String(this.leftVertex.vertexIndex):"null")+", "+(null!==this.rightVertex?String(this.rightVertex.vertexIndex):"null")+"::"},clipVertices:function(a){var b,c,d,e,g,i,j=h.core(a),k=a.x,l=a.y,m=j.right(),n=j.bottom();if(1===this.a&&this.b>=0?(b=this.rightVertex,c=this.leftVertex):(b=this.leftVertex,c=this.rightVertex),1===this.a){if(g=l,null!==b&&b.y>l&&(g=b.y),g>n)return;if(d=this.c-this.b*g,i=n,null!==c&&c.y<n&&(i=c.y),l>i)return;if(e=this.c-this.b*i,d>m&&e>m||k>d&&k>e)return;d>m?(d=m,g=(this.c-d)/this.b):k>d&&(d=k,g=(this.c-d)/this.b),e>m?(e=m,i=(this.c-e)/this.b):k>e&&(e=k,i=(this.c-e)/this.b)}else{if(d=k,null!==b&&b.x>k&&(d=b.x),d>m)return;if(g=this.c-this.a*d,e=m,null!==c&&c.x<m&&(e=c.x),k>e)return;if(i=this.c-this.a*e,g>n&&i>n||l>g&&l>i)return;g>n?(g=n,d=(this.c-g)/this.a):l>g&&(g=l,d=(this.c-g)/this.a),i>n?(i=n,e=(this.c-i)/this.a):l>i&&(i=l,e=(this.c-i)/this.a)}this.clippedEnds={},b===this.leftVertex?(this.clippedEnds[f.LEFT]={x:d,y:g},this.clippedEnds[f.RIGHT]={x:e,y:i}):(this.clippedEnds[f.RIGHT]={x:d,y:g},this.clippedEnds[f.LEFT]={x:e,y:i})},init:function(){this.leftSite=null,this.rightSite=null}},c.DELETED=new c.Edge,c.createBisectingEdge=function(a,b){var c,e,f,g,h,i,j;c=b.x-a.x,e=b.y-a.y,f=c>0?c:-c,g=e>0?e:-e,j=a.x*c+a.y*e+.5*(c*c+e*e),f>g?(h=1,i=e/c,j/=c):(i=1,h=c/e,j/=e);var k=d();return k.leftSite=a,k.rightSite=b,a.addEdge(k),b.addEdge(k),k.leftVertex=null,k.rightVertex=null,k.a=h,k.b=i,k.c=j,k},c.compareSitesDistancesMax=function(a,b){var c=a.sitesDistance(),d=b.sitesDistance();return d>c?1:c>d?-1:0},c.compareSitesDistances=function(a,b){return-c.compareSitesDistancesMax(a,b)}},{"../../as3/point-core":4,"../../as3/rectangle":5,"../geom/line-segment":35,"./lr":28}],25:[function(a,b){"use strict";var c=a("./halfedge"),d=a("../../janicek/core");b.exports=function(a,b,e){function f(){var a;for(l=0,m=0,k=[],a=0;n>a;a++)k[a]=c.createDummy(),k[a].nextInPriorityQueue=null}function g(a){var b=d.toInt((a.ystar-o)/p*n);return 0>b&&(b=0),b>=n&&(b=n-1),b}function h(a){return null===k[a].nextInPriorityQueue}function i(){for(;n-1>m&&h(m);)++m}var j={},k=null,l=0,m=0,n=0,o=0,p=0;return j.dispose=function(){var a;for(a=0;n>a;a++)k[a].dispose(),k[a]=null;k=null},j.insert=function(a){var b,c,d=g(a);for(m>d&&(m=d),b=k[d];null!==(c=b.nextInPriorityQueue)&&(a.ystar>c.ystar||a.ystar===c.ystar&&a.vertex.x>c.vertex.x);)b=c;a.nextInPriorityQueue=b.nextInPriorityQueue,b.nextInPriorityQueue=a,++l},j.remove=function(a){var b,c=g(a);if(null!==a.vertex){for(b=k[c];b.nextInPriorityQueue!==a;)b=b.nextInPriorityQueue;b.nextInPriorityQueue=a.nextInPriorityQueue,l--,a.vertex=null,a.nextInPriorityQueue=null,a.dispose()}},j.empty=function(){return 0===l},j.min=function(){i();var a=k[m].nextInPriorityQueue;return{x:a.vertex.x,y:a.ystar}},j.extractMin=function(){var a;return a=k[m].nextInPriorityQueue,k[m].nextInPriorityQueue=a.nextInPriorityQueue,l--,a.nextInPriorityQueue=null,a},o=a,p=b,n=4*e,f(),j}},{"../../janicek/core":10,"./halfedge":26}],26:[function(a,b,c){"use strict";var d=a("../../janicek/core").def,e=a("./lr"),f=[],g=function(a,b){a=d(a,null),b=d(b,null),this.init(a,b)};g.prototype={edgeListLeftNeighbor:null,edgeListRightNeighbor:null,nextInPriorityQueue:null,edge:null,leftRight:null,vertex:null,ystar:0,toString:function(){return"Halfedge (leftRight: "+this.leftRight+"; vertex: "+this.vertex+")"},dispose:function(){null===this.edgeListLeftNeighbor&&null===this.edgeListRightNeighbor&&null===this.nextInPriorityQueue&&(this.edge=null,this.leftRight=null,this.vertex=null,f.push(this))},reallyDispose:function(){this.edgeListLeftNeighbor=null,this.edgeListRightNeighbor=null,this.nextInPriorityQueue=null,this.edge=null,this.leftRight=null,this.vertex=null,f.push(this)},isLeftOf:function(a){var b,c,d,f,g,h,i,j,k,l,m;return b=this.edge.rightSite,c=a.x>b.x,c&&this.leftRight===e.LEFT?!0:c||this.leftRight!==e.RIGHT?(1===this.edge.a?(h=a.y-b.y,g=a.x-b.x,f=!1,!c&&this.edge.b<0||c&&this.edge.b>=0?(d=h>=this.edge.b*g,f=d):(d=a.x+a.y*this.edge.b>this.edge.c,this.edge.b<0&&(d=!d),d||(f=!0)),f||(i=b.x-this.edge.leftSite.x,d=this.edge.b*(g*g-h*h)<i*h*(1+2*g/i+this.edge.b*this.edge.b),this.edge.b<0&&(d=!d))):(m=this.edge.c-this.edge.a*a.x,j=a.y-m,k=a.x-b.x,l=m-b.y,d=j*j>k*k+l*l),this.leftRight===e.LEFT?d:!d):!1},init:function(a,b){return this.edge=a,this.leftRight=b,this.nextInPriorityQueue=null,this.vertex=null,this}},c.create=function(a,b){return f.length>0?f.pop().init(a,b):new g(a,b)},c.createDummy=function(){return c.create(null,null)}},{"../../janicek/core":10,"./lr":28}],27:[function(a,b,c){"use strict";var d=a("lodash"),e=a("../../janicek/core").def,f=a("../geom/line-segment").core,g=a("./node"),h=a("../../as3/point-core");c.find=function(a){if(a.parent===a)return a;var b=c.find(a.parent);return a.parent=b,b},c.kruskal=function(a,b){b=e(b,"minimum");var i={},j=[],k=[];switch(b){case"maximum":a.sort(f.compareLengths);break;default:a.sort(f.compareLengthsMax)}for(var l=a.length-1;l>=0;){var m=a[l];l--;var n,o=i[h.hash(m.p0)];null===o?(o=k.length>0?k.pop():g(),n=o.parent=o,o.treeSize=1,i[h.hash(m.p0)]=o):n=c.find(o);var p,q=i[h.hash(m.p1)];if(null===q?(q=k.length>0?k.pop():g(),p=q.parent=q,q.treeSize=1,i[h.hash(m.p1)]=q):p=c.find(q),n!==p){j.push(m);var r=n.treeSize,s=p.treeSize;r>=s?(p.parent=n,n.treeSize+=s):(n.parent=p,p.treeSize+=r)}}return d(i).each(function(a){k.push(a)}),j}},{"../../as3/point-core":4,"../../janicek/core":10,"../geom/line-segment":35,"./node":29,lodash:1}],28:[function(a,b){"use strict";b.exports={LEFT:"left",RIGHT:"right",other:function(a){return a===this.LEFT?this.RIGHT:this.LEFT}}},{}],29:[function(a,b){"use strict";b.exports=function(){return{parent:null,treeSize:0}},b.exports.pool=[]},{}],30:[function(a,b){"use strict";var c=a("lodash"),d=a("../geom/circle"),e=a("../../janicek/core").def,f=a("../../as3/rectangle"),g=a("./site");b.exports=function(){var a=[],b=0,h=!1,i={};return i.dispose=function(){null!==a&&(c(a).each(function(a){a.dispose()}),a=null)},i.push=function(b){return h=!1,a.push(b)},Object.defineProperties(i,{length:{get:function(){return a.length}}}),i.next=function(){if(h===!1)throw"SiteList::next():  sites have not been sorted";return b<a.length?a[b++]:null},i.getSitesBounds=function(){h===!1&&(g.sortSites(a),b=0,h=!0);var d,e,i,j;return 0===a.length?f(0,0,0,0):(d=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,c(a).each(function(a){a.x<d&&(d=a.x),a.x>e&&(e=a.x)}),i=a[0].y,j=a[a.length-1].y,f(d,i,e-d,j-i))},i.siteColors=function(b){b=e(b,null);var d=[];return c(a).each(function(a){d.push(null!==b?b.getPixel(a.x,a.y):a.color)}),d},i.siteCoords=function(){var b=[];return c(a).each(function(a){b.push(a.coord)}),b},i.circles=function(){var b=[];return c(a).each(function(a){var c=a.nearestEdge(),e=c.isPartOfConvexHull()?0:.5*c.sitesDistance();b.push(d(a.x,a.y,e))}),b},i.regions=function(b){var d=[];return c(a).each(function(a){d.push(a.region(b))}),d},i.nearestSitePoint=function(b,c,d){var e=b.getPixel(c,d);return e>a.length-1?null:a[e].coord},i}},{"../../as3/rectangle":5,"../../janicek/core":10,"../geom/circle":34,"./site":31,lodash:1}],31:[function(a,b,c){"use strict";function d(a,b){return l.distance(a,b)<r}var e=a("lodash"),f=a("./bounds-check"),g=a("./criterion"),h=a("../../janicek/core").def,i=a("./edge"),j=a("./edge-reorderer"),k=a("./lr"),l=a("../../as3/point-core"),m=a("../geom/polygon"),n=a("../../as3/rectangle").core,o=a("./voronoi"),p=a("../geom/winding"),q=[],r=.005,s=function(a,b,c,d){this.init(a,b,c,d)};s.prototype={_coord:null,get coord(){return this._coord},color:0,weight:0,_siteIndex:0,_edges:null,get edges(){return this._edges},_edgeOrientations:null,_region:null,init:function(a,b,c,d){return this._coord=a,this._siteIndex=b,this.weight=c,this.color=d,this._edges=[],this._region=null,this},toString:function(){return"Site "+this._siteIndex+": "+String(this.coord)},dispose:function(){this._coord=null,this._clear(),q.push(this)},_clear:function(){null!==this._edges&&(this._edges=null),null!==this._edgeOrientations&&(this._edgeOrientations=null),null!==this._region&&(this._region=null)},addEdge:function(a){this._edges.push(a)},nearestEdge:function(){return this._edges.sort(i.compareSitesDistances),this._edges[0]},neighborSites:function(){if(null===this._edges||0===this._edges.length)return[];null===this._edgeOrientations&&this._reorderEdges();var a=[];return e.each(this._edges,function(b){a.push(this._neighborSite(b))}),a},_neighborSite:function(a){return this===a.leftSite?a.rightSite:this===a.rightSite?a.leftSite:null},region:function(a){return null===this._edges||0===this._edges.length?[]:(null===this._edgeOrientations&&(this._reorderEdges(),this._region=this._clipToBounds(a),m(this._region).winding()===p.CLOCKWISE&&this._region.reverse()),this._region)},_reorderEdges:function(){var a=j(this._edges,g.vertex);this._edges=a.edges,this._edgeOrientations=a.edgeOrientations,a.dispose()},_clipToBounds:function(a){for(var b=[],c=this._edges.length,d=0,e=null;c>d&&this._edges[d].visible===!1;)++d;if(d===c)return[];e=this._edges[d];var f=this._edgeOrientations[d];b.push(e.clippedEnds[f]),b.push(e.clippedEnds[k.other(f)]);for(var g=d+1;c>g;g++)e=this._edges[g],e.visible!==!1&&this._connect(b,g,a);return this._connect(b,d,a,!0),b},_connect:function(a,b,c,e){e=h(e,!1);var g=a[a.length-1],i=this._edges[b],j=this._edgeOrientations[b],l=i.clippedEnds[j];if(!d(g,l)){if(g.x!==l.x&&g.y!==l.y){var m,o,p=f.check(g,c),q=f.check(l,c);0!==(p&f.RIGHT)?(m=n(c).right(),0!==(q&f.BOTTOM)?(o=n(c).bottom(),a.push({x:m,y:o})):0!==(q&f.TOP)?(o=n(c).top(),a.push({x:m,y:o})):0!==(q&f.LEFT)&&(o=g.y-c.y+l.y-c.y<c.height?n(c).top():n(c).bottom(),a.push({x:m,y:o}),a.push({x:n(c).left(),y:o}))):0!==(p&f.LEFT)?(m=n(c).left(),0!==(q&f.BOTTOM)?(o=n(c).bottom(),a.push({x:m,y:o})):0!==(q&f.TOP)?(o=n(c).top(),a.push({x:m,y:o})):0!==(q&f.RIGHT)&&(o=g.y-c.y+l.y-c.y<c.height?n(c).top():n(c).bottom(),a.push({x:m,y:o}),a.push({x:n(c).right(),y:o}))):0!==(p&f.TOP)?(o=n(c).top(),0!==(q&f.RIGHT)?(m=n(c).right(),a.push({x:m,y:o})):0!==(q&f.LEFT)?(m=n(c).left(),a.push({x:m,y:o})):0!==(q&f.BOTTOM)&&(m=g.x-c.x+l.x-c.x<c.width?n(c).left():n(c).right(),a.push({x:m,y:o}),a.push({x:m,y:n(c).bottom()}))):0!==(p&f.BOTTOM)&&(o=n(c).bottom(),0!==(q&f.RIGHT)?(m=n(c).right(),a.push({x:m,y:o})):0!==(q&f.LEFT)?(m=n(c).left(),a.push({x:m,y:o})):0!==(q&f.TOP)&&(m=g.x-c.x+l.x-c.x<c.width?n(c).left():n(c).right(),a.push({x:m,y:o}),a.push({x:m,y:n(c).top()})))}if(e)return;a.push(l)}var r=i.clippedEnds[k.other(j)];d(a[0],r)||a.push(r)},get x(){return this._coord.x},get y(){return this._coord.y},dist:function(a){return l.distance(a.coord,this.coord)}},c.create=function(a,b,c,d){return q.length>0?q.pop().init(a,b,c,d):new s(a,b,c,d)},c.sortSites=function(a){a.sort(o.compareSiteByYThenX),e(a).each(function(b,c){a[c]._siteIndex=c})}},{"../../as3/point-core":4,"../../as3/rectangle":5,"../../janicek/core":10,"../geom/polygon":36,"../geom/winding":37,"./bounds-check":19,"./criterion":20,"./edge":24,"./edge-reorderer":23,"./lr":28,"./voronoi":33,lodash:1}],32:[function(a,b,c){"use strict";function d(a,b){return isNaN(a)||isNaN(b)?c.VERTEX_AT_INFINITY:e.length>0?e.pop().init(a,b):new g(a,b)}var e=[],f=0,g=function(a,b){this.init(a,b)};g.prototype={_coord:null,get coord(){return this._coord},vertexIndex:0,init:function(a,b){return this._coord={x:a,y:b},this},dispose:function(){this._coord=null,e.push(this)},setIndex:function(){this.vertexIndex=f++},toString:function(){return"Vertex ("+this.vertexIndex+")"},get x(){return this._coord.x},get y(){return this._coord.y}},c.VERTEX_AT_INFINITY=new g(0/0,0/0),c.intersect=function(b,c){var e,f,g,h,i,j,k,l,m=a("./voronoi"),n=a("./lr");return e=b.edge,f=c.edge,null===e||null===f?null:e.rightSite===f.rightSite?null:(i=e.a*f.b-e.b*f.a,i>-1e-10&&1e-10>i?null:(j=(e.c*f.b-f.c*e.b)/i,k=(f.c*e.a-e.c*f.a)/i,m.compareSiteByYThenX(e.rightSite,f.rightSite)<0?(h=b,g=e):(h=c,g=f),l=j>=g.rightSite.x,l&&h.leftRight===n.LEFT||!l&&h.leftRight===n.RIGHT?null:d(j,k)))}},{"./lr":28,"./voronoi":33}],33:[function(a,b){"use strict";var c=a("lodash"),d=a("./criterion"),e=a("../../janicek/core"),f=a("../../janicek/core").def,g=a("./delaunay"),h=a("./edge-list"),i=a("./edge"),j=a("./edge-reorderer"),k=a("./halfedge"),l=a("./halfedge-priority-queue"),m=a("./kruskal"),n=a("./lr"),o=a("../../as3/point-core"),p=a("../../polygonal/pm-prng"),q=a("./site-list"),r=a("./site"),s=a("./vertex"),t=function(a,b,u){function v(a){var b={};c(a).each(function(a){if(c(b).has(o.hash(a)))throw"Duplicate points not supported yet!";b[o.hash(a)]=a})}function w(a,b){for(var c=a.length,d=0;c>d;d++)x(a[d],null!==b?b[d]:0,d)}function x(a,b,c){var d=100*A.nextDouble(),e=r.create(a,c,d,b);B.push(e),C[o.hash(a)]=e}function y(){return c(E).filter(function(a){return a.isPartOfConvexHull()})}function z(){function a(a){var b=a.edge;return null===b?I:b.site(a.leftRight)}function b(a){var b=a.edge;return null===b?I:b.site(n.other(a.leftRight))}var d,f,g,j,m,o,p,q,r,u,v,w,x,y,z=B.getSitesBounds(),A=e.toInt(Math.sqrt(B.length+4)),C=l(z.y,z.height,A),D=h(z.x,z.width,A),G=[],H=[],I=B.next();for(d=B.next();;)if(C.empty()===!1&&(p=C.min()),null!==d&&(C.empty()||t.comparePointByYThenX(d,p)<0))r=D.edgeListLeftNeighbor(d.coord),u=r.edgeListRightNeighbor,f=b(r),y=i.createBisectingEdge(f,d),E.push(y),x=k.create(y,n.LEFT),G.push(x),D.insert(r,x),null!==(o=s.intersect(r,x))&&(H.push(o),C.remove(r),r.vertex=o,r.ystar=o.y+d.dist(o),C.insert(r)),r=x,x=k.create(y,n.RIGHT),G.push(x),D.insert(r,x),null!==(o=s.intersect(x,u))&&(H.push(o),x.vertex=o,x.ystar=o.y+d.dist(o),C.insert(x)),d=B.next();else{if(C.empty()!==!1)break;
r=C.extractMin(),v=r.edgeListLeftNeighbor,u=r.edgeListRightNeighbor,w=u.edgeListRightNeighbor,f=a(r),g=b(u),m=r.vertex,m.setIndex(),r.edge.setVertex(r.leftRight,m),u.edge.setVertex(u.leftRight,m),D.remove(r),C.remove(u),D.remove(u),q=n.LEFT,f.y>g.y&&(j=f,f=g,g=j,q=n.RIGHT),y=i.createBisectingEdge(f,g),E.push(y),x=k.create(y,q),G.push(x),D.insert(v,x),y.setVertex(n.other(q),m),null!==(o=s.intersect(v,x))&&(H.push(o),C.remove(v),v.vertex=o,v.ystar=o.y+f.dist(o),C.insert(v)),null!==(o=s.intersect(x,w))&&(H.push(o),x.vertex=o,x.ystar=o.y+f.dist(o),C.insert(x))}C.dispose(),D.dispose(),c(G).each(function(a){a.reallyDispose()}),c(E).each(function(a){a.clipVertices(F.plotBounds)}),c(H).each(function(a){a.dispose()})}var A=p(),B=q(),C={},D=[],E=[],F={};return F.plotBounds=u,F.dispose=function(){var a,b;if(null!==B&&(B.dispose(),B=null),null!==D){for(b=D.length,a=0;b>a;a++)D[a].dispose();D=null}if(null!==E){for(b=E.length,a=0;b>a;a++)E[a].dispose();E=null}F.plotBounds=null,C=null},F.edges=function(){return E},F.region=function(a){var b=C[o.hash(a)];return null===b?[]:b.region(F.plotBounds)},F.neighborSitesForSite=function(a){var b=[],d=C[o.hash(a)];if(null===d)return b;var e=d.neighborSites();return c(e).each(function(a){b.push(a.coord)}),b},F.circles=function(){return B.circles()},F.voronoiBoundaryForSite=function(a){return g.visibleLineSegments(g.selectEdgesForSitePoint(a,E))},F.delaunayLinesForSite=function(a){return g.delaunayLinesForEdges(g.selectEdgesForSitePoint(a,E))},F.voronoiDiagram=function(){return g.visibleLineSegments(E)},F.delaunayTriangulation=function(a){return a=f(a,null),g.delaunayLinesForEdges(g.selectNonIntersectingEdges(a,E))},F.hull=function(){return g.delaunayLinesForEdges(y())},F.hullPointsInOrder=function(){var a=a(),b=[];if(0===a.length)return b;var c=j(a,d.site);a=c.edges;var e=c.edgeOrientations;c.dispose();var f,g,h=a.length;for(g=0;h>g;g++){var i=a[g];f=e[g],b.push(i.site(f).coord)}return b},F.spanningTree=function(a,b){a=f(a,"minimum"),b=f(b,null);var c=g.selectNonIntersectingEdges(b,E),d=g.delaunayLinesForEdges(c);return m.kruskal(d,a)},F.regions=function(){return B.regions(F.plotBounds)},F.siteColors=function(a){return a=f(a,null),B.siteColors(a)},F.nearestSitePoint=function(a,b,c){return B.nearestSitePoint(a,b,c)},F.siteCoords=function(){return B.siteCoords()},v(a),A.seed=1,w(a,b),z(),F};t.isInfSite=function(a,b){return a.y<b.y||a.y===b.y&&a.x<b.x},t.comparePointByYThenX=function(a,b){return t.compareByYThenX(a.x,a.y,b.x,b.y)},t.compareSiteByYThenX=function(a,b){return t.compareByYThenX(a.x,a.y,b.x,b.y)},t.compareByYThenX=function(a,b,c,d){return d>b?-1:b>d?1:c>a?-1:a>c?1:0},b.exports=t},{"../../as3/point-core":4,"../../janicek/core":10,"../../polygonal/pm-prng":38,"./criterion":20,"./delaunay":21,"./edge":24,"./edge-list":22,"./edge-reorderer":23,"./halfedge":26,"./halfedge-priority-queue":25,"./kruskal":27,"./lr":28,"./site":31,"./site-list":30,"./vertex":32,lodash:1}],34:[function(a,b){"use strict";b.exports=function(a,b,c){return{center:{x:a,y:b},radius:c,toString:function(){return"Circle (center: "+this.center+"; radius: "+this.radius+")"}}}},{}],35:[function(a,b){"use strict";var c=a("../../as3/point-core");b.exports=function(a,b){return{p0:a,p1:b}},b.exports.core={compareLengthsMax:function(a,b){var d=c.distance(a.p0,a.p1),e=c.distance(b.p0,b.p1);return e>d?1:d>e?-1:0},compareLengths:function(a,b){return-this.compareLengthsMax(a,b)}}},{"../../as3/point-core":4}],36:[function(a,b){"use strict";var c=a("./winding"),d=function(a){this._vertices=a};d.prototype={area:function(){return Math.abs(.5*this.signedDoubleArea())},winding:function(){var a=this.signedDoubleArea();return 0>a?c.CLOCKWISE:a>0?c.COUNTERCLOCKWISE:c.NONE},signedDoubleArea:function(){var a,b,c,d,e=this._vertices.length,f=0;for(a=0;e>a;a++)b=(a+1)%e,c=this._vertices[a],d=this._vertices[b],f+=c.x*d.y-d.x*c.y;return f}},b.exports=function(a){return new d(a)}},{"./winding":37}],37:[function(a,b){"use strict";b.exports={CLOCKWISE:"clockwise",COUNTERCLOCKWISE:"counterclockwise",NONE:"none"}},{}],38:[function(a,b){"use strict";b.exports=function(){return{seed:1,nextDouble:function(){return this.gen()/2147483647},nextIntRange:function(a,b){return a-=.4999,b+=.4999,Math.round(a+(b-a)*this.nextDouble())},nextDoubleRange:function(a,b){return a+(b-a)*this.nextDouble()},gen:function(){return this.seed=16807*this.seed%2147483647,this.seed}}}},{}],39:[function(a,b,c){"use strict";function d(a,b){for(var c=0;c<b.length;c++)a.lineTo(b[c].x,b[c].y)}function e(a,b,c,d,e,f,i,j){var l=k(),n=b.add(c).add(d);n.scaleBy(1/3);var o=c.subtract(b).crossProduct(d.subtract(b));o.normalize();var p=m(-o.x/o.z,-o.y/o.z,0),q=m(n.x-p.x*((n.z-.5)/p.length/p.length),n.y-p.y*((n.z-.5)/p.length/p.length));if(p.length<1e-6){var r=e[0];2===e.length?r=h.interpolateColor(e[0],e[1],n.z):3===e.length&&(r=n.z<.5?h.interpolateColor(e[0],e[1],2*n.z):h.interpolateColor(e[1],e[2],2*n.z-1)),a.fillStyle=h.intToHexColor(r)}else l.createGradientBox(1,1,0,0,0),l.translate(-.5,-.5),l.scale(1/p.length,1/p.length),l.rotate(Math.atan2(p.y,p.x)),l.translate(q.x,q.y),g(e).map(function(){return 1}),g(e).map(function(a,b){return 255*b/(e.length-1)});f(a,i,j),a.fill()}function f(a,b){for(var c=b.length-1;c>=0;)a.lineTo(b[c].x,b[c].y),c--}var g=a("lodash"),h=a("../janicek/html-color"),i=a("../as3/conversion-core"),j=a("../janicek/core"),k=a("../as3/matrix"),l=a("../as3/point-core"),m=a("../as3/vector-3d");c.graphicsReset=function(a,b,c,d){a.lineWidth=1,a.clearRect(0,0,2e3,2e3),a.fillStyle="#bbbbaa",a.fillRect(0,0,2e3,2e3),a.fillStyle=h.intToHexColor(d.OCEAN),a.fillRect(0,0,j.toInt(b),j.toInt(c))};var n=m(-1,-1,0);c.calculateLighting=function(a,b,c){var d=m(a.point.x,a.point.y,a.elevation),e=m(b.point.x,b.point.y,b.elevation),f=m(c.point.x,c.point.y,c.elevation),g=e.subtract(d).crossProduct(f.subtract(d));g.z<0&&g.scaleBy(-1),g.normalize();var h=.5+35*g.dotProduct(n);return 0>h&&(h=0),h>1&&(h=1),h},c.colorWithSlope=function(a,b,d,e,f){var i=e.v0,j=e.v1;if(g.isNull(i)||g.isNull(j))return f.OCEAN;if(b.water)return a;null!==d&&b.water===d.water&&(a=h.interpolateColor(a,f[d.biome],.4));var k=h.interpolateColor(a,3355443,.7),l=h.interpolateColor(a,16777215,.3),m=c.calculateLighting(b,i,j);return.5>m?h.interpolateColor(k,a,2*m):h.interpolateColor(a,l,2*m-1)},c.colorWithSmoothColors=function(a,b,c,d,e){return null!==c&&b.water===c.water&&(a=h.interpolateColor(e[b.biome],e[c.biome],.25)),a},c.renderDebugPolygons=function(a,b,c){var d;0===b.centers.length&&(a.fillStyle="#dddddd",a.fillRect(0,0,j.toInt(b.SIZE.width),j.toInt(b.SIZE.height)),g(b.points).each(function(b){a.beginPath(),a.strokeStyle="#000000",a.fillStyle="#000000",a.arc(b.x,b.y,1.3,Math.PI,2*Math.PI,!1),a.closePath(),a.fill(),a.stroke()})),g(b.centers).each(function(b){d=g.isNull(b.biome)?b.ocean?c.OCEAN:b.water?c.RIVER:16777215:c[b.biome],a.beginPath(),g(b.borders).each(function(c){g.isNull(c.v0)||g.isNull(c.v1)||(a.moveTo(b.point.x,b.point.y),a.lineTo(c.v0.point.x,c.v0.point.y),a.lineTo(c.v1.point.x,c.v1.point.y))}),a.closePath(),a.fillStyle=h.intToHexColor(h.interpolateColor(d,14540253,.2)),a.fill(),g(b.borders).each(function(b){g.isNull(b.v0)||g.isNull(b.v1)||(a.beginPath(),a.moveTo(b.v0.point.x,b.v0.point.y),b.river>0?(a.lineWidth=1,a.strokeStyle=h.intToHexColor(c.RIVER)):(a.lineWidth=.1,a.strokeStyle="#000000"),a.lineTo(b.v1.point.x,b.v1.point.y),a.closePath(),a.stroke())}),a.beginPath(),a.fillStyle=b.water?"#003333":"#000000",a.globalAlpha=.7,a.arc(b.point.x,b.point.y,1.3,Math.PI,2*Math.PI,!1),a.closePath(),a.fill(),a.globalAlpha=1,g(b.corners).each(function(b){a.fillStyle=b.water?"#0000ff":"#009900",a.fillRect(j.toInt(b.point.x-.7),j.toInt(b.point.y-.7),j.toInt(1.5),j.toInt(1.5))})})},c.renderWatersheds=function(a,b,c){var d,e,f;g(b.edges).each(function(d){g.isNull(d.d0)||g.isNull(d.d1)||g.isNull(d.v0)||g.isNull(d.v1)||d.d0.ocean||d.d1.ocean||(e=c.watersheds[d.d0.index],f=c.watersheds[d.d1.index],e!==f&&(a.beginPath(),a.lineWidth=3.5,a.strokeStyle=h.rgba(0,0,0,.1*Math.sqrt(j.coalesce(b.corners[e].watershedSize,1)+j.coalesce(b.corners[f].watershed.watershedSize,1))),a.moveTo(d.v0.point.x,d.v0.point.y),a.lineTo(d.v1.point.x,d.v1.point.y),a.closePath(),a.stroke()))});for(d in b.edges)i.booleanFromInt(d.river)&&(a.beginPath(),a.lineWidth=1,a.strokeStyle="#6699ff",a.moveTo(d.v0.point.x,d.v0.point.y),a.lineTo(d.v1.point.x,d.v1.point.y),a.closePath(),a.stroke())},c.renderPolygons=function(a,b,c,f,g,i){a.fillStyle=h.intToHexColor(b.OCEAN),a.fillRect(0,0,j.toInt(g.SIZE.width),j.toInt(g.SIZE.height));for(var k=function(a,b,c){var e=i.path0[r.index];a.moveTo(b,c),a.lineTo(e[0].x,e[0].y),d(a,e),a.lineTo(b,c)},l=function(a,b,c){var e=i.path1[r.index];a.moveTo(b,c),a.lineTo(e[0].x,e[0].y),d(a,e),a.lineTo(b,c)},n=0;n<g.centers.length;n++)for(var o=g.centers[n],p=0;p<o.neighbors.length;p++){var q=o.neighbors[p],r=g.lookupEdgeFromCenter(o,q),s=j.coalesce(b[o.biome],0);if(null!==f&&(s=f(s,o,q,r,b)),!j.isUndefinedOrNull(i.path0[r.index])&&!j.isUndefinedOrNull(i.path1[r.index]))if(j.isUndefinedOrNull(c))a.fillStyle=h.intToHexColor(s),a.strokeStyle=a.fillStyle,a.beginPath(),k(a,o.point.x,o.point.y),l(a,o.point.x,o.point.y),a.closePath(),a.fill(),a.stroke();else{var t=r.v0,u=r.v1,v=r.midpoint,w=.5*(t[c]+u[c]);e(a,m(o.point.x,o.point.y,o[c]),m(t.point.x,t.point.y,t[c]),m(v.x,v.y,w),[b.GRADIENT_LOW,b.GRADIENT_HIGH],k,o.point.x,o.point.y),e(a,m(o.point.x,o.point.y,o[c]),m(v.x,v.y,w),m(u.point.x,u.point.y,u[c]),[b.GRADIENT_LOW,b.GRADIENT_HIGH],l,o.point.x,o.point.y)}}},c.renderBridges=function(a,b,c,d){g(b.edges).each(function(b){if(b.river>0&&b.river<4&&!b.d0.water&&!b.d1.water&&(b.d0.elevation>.05||b.d1.elevation>.05)){var e={x:-(b.v1.point.y-b.v0.point.y),y:b.v1.point.x-b.v0.point.x};l.normalize(e,.25+(g.isNull(c.road[b.index])?0:.5)+.75*Math.sqrt(b.river)),a.beginPath(),a.lineWidth=1.1,a.strokeStyle=h.intToHexColor(d.BRIDGE),a.lineCap="square",a.moveTo(b.midpoint.x-e.x,b.midpoint.y-e.y),a.lineTo(b.midpoint.x+e.x,b.midpoint.y+e.y),a.closePath(),a.stroke()}})},c.renderRoads=function(a,b,c,d){function e(a,b,c){var d={x:-(a.v1.point.y-a.v0.point.y),y:a.v1.point.x-a.v0.point.x},e=l.subtract(b,a.midpoint);return d.x*e.x+d.y*e.y<0&&(d.x=-d.x,d.y=-d.y),l.normalize(d,c),d}var f,i,k,m,n,o,p,q,r;g(b.centers).each(function(b){if(!j.isUndefinedOrNull(c.roadConnections[b.index]))if(2===c.roadConnections[b.index].length){for(r=b.borders,m=0;m<r.length;m++)if(p=r[m],c.road[p.index]>0)for(n=m+1;n<r.length;n++)q=r[n],c.road[q.index]>0&&(o=.5*Math.min(l.distanceFromOrigin(l.subtract(p.midpoint,b.point)),l.distanceFromOrigin(l.subtract(q.midpoint,b.point))),f=l.add(e(p,b.point,o),p.midpoint),i=l.add(e(q,b.point,o),q.midpoint),k=l.interpolate(f,i,.5),a.beginPath(),a.lineWidth=1.1,a.strokeStyle=h.intToHexColor(d["ROAD"+c.road[p.index]]),a.moveTo(p.midpoint.x,p.midpoint.y),a.quadraticCurveTo(f.x,f.y,k.x,k.y),a.moveTo(k.x,k.y),a.lineWidth=1.1,a.strokeStyle=h.intToHexColor(d["ROAD"+c.road[q.index]]),a.quadraticCurveTo(i.x,i.y,q.midpoint.x,q.midpoint.y),a.stroke(),a.closePath())}else g(b.borders).each(function(g){c.road[g.index]>0&&(o=.25*l.distanceFromOrigin(l.subtract(g.midpoint,b.point)),f=l.add(e(g,b.point,o),g.midpoint),a.beginPath(),a.lineWidth=1.4,a.strokeStyle=h.intToHexColor(d["ROAD"+c.road[g.index]]),a.moveTo(g.midpoint.x,g.midpoint.y),a.quadraticCurveTo(f.x,f.y,b.point.x,b.point.y),a.stroke(),a.closePath())})})},c.renderEdges=function(a,b,c,e,g,k){k=j.def(k,!0);for(var l,m=0;m<c.centers.length;m++)for(var n=c.centers[m],o=0;o<n.neighbors.length;o++){var p=n.neighbors[o];if(l=c.lookupEdgeFromCenter(n,p),!j.isUndefinedOrNull(e.path0[l.index])&&!j.isUndefinedOrNull(e.path1[l.index])){if(n.ocean!==p.ocean)a.lineWidth=2,a.strokeStyle=h.intToHexColor(b.COAST);else if(i.intFromBoolean(n.water)>0!=i.intFromBoolean(p.water)>0&&"ICE"!==n.biome&&"ICE"!==p.biome)a.lineWidth=1,a.strokeStyle=h.intToHexColor(b.LAKESHORE);else{if(n.water||p.water)continue;if(g.lava[l.index])a.lineWidth=1,a.strokeStyle=h.intToHexColor(b.LAVA);else{if(!(l.river>0&&k))continue;a.lineWidth=Math.sqrt(l.river),a.strokeStyle=h.intToHexColor(b.RIVER)}}a.beginPath(),a.moveTo(e.path0[l.index][0].x,e.path0[l.index][0].y),d(a,e.path0[l.index]),f(a,e.path1[l.index]),a.stroke(),a.closePath()}}},c.renderAllEdges=function(a,b,c,e){var g;a.lineWidth=5,a.strokeStyle=b;for(var h=0;h<c.centers.length;h++)for(var i=c.centers[h],k=0;k<i.neighbors.length;k++){var l=i.neighbors[k];g=c.lookupEdgeFromCenter(i,l),j.isUndefinedOrNull(e.path0[g.index])||j.isUndefinedOrNull(e.path1[g.index])||i.water||(a.beginPath(),a.moveTo(e.path0[g.index][0].x,e.path0[g.index][0].y),d(a,e.path0[g.index]),f(a,e.path1[g.index]),a.stroke(),a.closePath())}}},{"../as3/conversion-core":2,"../as3/matrix":3,"../as3/point-core":4,"../as3/vector-3d":6,"../janicek/core":10,"../janicek/html-color":12,lodash:1}],40:[function(a,b){"use strict";b.exports=function(){return{index:null,point:null,water:null,ocean:null,coast:null,border:null,biome:null,elevation:null,moisture:null,neighbors:null,borders:null,corners:null}}},{}],41:[function(a,b){"use strict";b.exports=function(){return{index:null,point:null,ocean:null,water:null,coast:null,border:null,elevation:null,moisture:null,touches:null,protrudes:null,adjacent:null,river:null,downslope:null,watershed:null,watershedSize:null}}},{}],42:[function(a,b){"use strict";b.exports=function(){return{index:0,d0:null,d1:null,v0:null,v1:null,midpoint:null,river:0}}},{}],43:[function(a,b,c){"use strict";var d=a("../janicek/array2d"),e=a("../janicek/core"),f=a("../as3/point-core").distanceFromOrigin,g=a("../janicek/perlin-noise"),h=a("../polygonal/pm-prng"),i=a("../janicek/pseudo-random-number-generators");c.makeRadial=function(a,b){function c(a){var c=Math.atan2(a.y,a.x),d=.5*(Math.max(Math.abs(a.x),Math.abs(a.y))+f(a)),e=.5+.4*Math.sin(i+g*c+Math.cos((g+3)*c)),h=.7-.2*Math.sin(i+g*c-Math.sin((g+2)*c));return(Math.abs(c-j)<k||Math.abs(c-j+2*Math.PI)<k||Math.abs(c-j-2*Math.PI)<k)&&(e=h=.2),e>d||d>e*b&&h>d}b=e.def(b,1.07);var d=h();d.seed=a;var g=d.nextIntRange(1,6),i=d.nextDoubleRange(0,2*Math.PI),j=d.nextDoubleRange(0,2*Math.PI),k=d.nextDoubleRange(.2,.7);return c},c.makePerlin=function(a,b){b=e.def(b,.5);var c=.1,h=.5;b=(h-c)*b+c;var i=d(g.makePerlinNoise(256,256,1,1,1,a,8));return function(a){var c=(255&i.get(e.toInt(128*(a.x+1)),e.toInt(128*(a.y+1))))/255;return c>b+b*f(a)*f(a)}},c.makeSquare=function(){return function(){return!0}},c.makeBlob=function(){return function(a){var b=f({x:a.x-.2,y:a.y/2+.2})<.05,c=f({x:a.x+.2,y:a.y/2+.2})<.05,d=f(a)<.8-.18*Math.sin(5*Math.atan2(a.y,a.x));return d&&!b&&!c}},c.makeBitmap=function(a){a=d(a);var b=a.dimensions();return function(c){var d=(c.x+1)/2*b.x,e=(c.y+1)/2*b.y;return a.get(d,e)}},c.makeNoise=function(a){return function(){return a=i.nextParkMiller(a),i.toBool(a)}}},{"../as3/point-core":4,"../janicek/array2d":8,"../janicek/core":10,"../janicek/perlin-noise":15,"../janicek/pseudo-random-number-generators":16,"../polygonal/pm-prng":38}],44:[function(a,b,c){"use strict";var d=a("lodash"),e=a("../as3/conversion-core");b.exports=function(){return{lava:[],createLava:function(a,b){d(a.edges).each(function(a){!e.booleanFromInt(a.river)&&!a.d0.water&&!a.d1.water&&a.d0.elevation>.8&&a.d1.elevation>.8&&a.d0.moisture<.3&&a.d1.moisture<.3&&b()<c.FRACTION_LAVA_FISSURES&&(this.lava[a.index]=!0)})}}},b.exports.FRACTION_LAVA_FISSURES=.2},{"../as3/conversion-core":2,lodash:1}],45:[function(a,b){"use strict";var c=a("lodash"),d=a("./graph/center"),e=a("../as3/conversion-core"),f=a("./graph/corner"),g=a("../janicek/core"),h=a("./graph/edge"),i=a("../polygonal/pm-prng"),j=a("../as3/point-core"),k=a("../as3/rectangle"),l=a("../nodename/delaunay/voronoi"),m=function(a){var b={};return b.SIZE=a,b.islandShape=null,b.mapRandom=i(),b.points=[],b.centers=[],b.corners=[],b.edges=[],b.newIsland=function(a,c){b.islandShape=a,b.mapRandom.seed=c},b.go0PlacePoints=function(a){a=g.def(a,m.DEFAULT_NUMBER_OF_POINTS),b.reset(),b.points=b.generateRandomPoints(a)},b.go1ImprovePoints=function(a){a=g.def(a,m.DEFAULT_LLOYD_ITERATIONS),b.improveRandomPoints(b.points,a)},b.go2BuildGraph=function(){var a=l(b.points,null,k(0,0,b.SIZE.width,b.SIZE.height));b.buildGraph(b.points,a),b.improveCorners(),a.dispose(),a=null,b.points=null},b.go3AssignElevations=function(a){a=g.def(a,m.DEFAULT_LAKE_THRESHOLD),b.assignCornerElevations(),b.assignOceanCoastAndLand(a),b.redistributeElevations(b.landCorners(b.corners)),c(b.corners).each(function(a){(a.ocean||a.coast)&&(a.elevation=0)}),b.assignPolygonElevations()},b.go4AssignMoisture=function(a){a=g.def(a,null),b.calculateDownslopes(),b.calculateWatersheds(),b.createRivers(a),b.assignCornerMoisture(),b.redistributeMoisture(b.landCorners(b.corners)),b.assignPolygonMoisture()},b.go5DecorateMap=function(){b.assignBiomes()},b.reset=function(){null!==b.points&&b.points.splice(0,b.points.length),null!==b.edges&&(c(b.edges).each(function(a){a.d0=a.d1=null,a.v0=a.v1=null}),b.edges.splice(0,b.edges.length)),null!==b.centers&&(c(b.centers).each(function(a){a.neighbors.splice(0,a.neighbors.length),a.corners.splice(0,a.corners.length),a.borders.splice(0,a.borders.length)}),b.centers.splice(0,b.centers.length)),null!==b.corners&&(c(b.corners).each(function(a){a.adjacent.splice(0,a.adjacent.length),a.touches.splice(0,a.touches.length),a.protrudes.splice(0,a.protrudes.length),a.downslope=null,a.watershed=null}),b.corners.splice(0,b.corners.length)),null===b.points&&(b.points=[]),null===b.edges&&(b.edges=[]),null===b.centers&&(b.centers=[]),null===b.corners&&(b.corners=[])},b.generateRandomPoints=function(a){var c,d,e=[];for(d=0;a>d;d++)c={x:b.mapRandom.nextDoubleRange(10,b.SIZE.width-10),y:b.mapRandom.nextDoubleRange(10,b.SIZE.height-10)},e.push(c);return e},b.improveRandomPoints=function(a,c){var d,e,f;for(d=0;c>d;d++){e=l(a,null,k(0,0,b.SIZE.width,b.SIZE.height));for(var g=0;g<a.length;g++){var h=a[g];f=e.region(h),h.x=0,h.y=0;for(var i=0;i<f.length;i++){var j=f[i];h.x+=j.x,h.y+=j.y}h.x/=f.length,h.y/=f.length,f.splice(0,f.length)}e.dispose()}},b.improveCorners=function(){var a,d,e=[];for(c(b.corners).each(function(b){b.border?e[b.index]=b.point:(a={x:0,y:0},c(b.touches).each(function(b){a.x+=b.point.x,a.y+=b.point.y}),a.x/=b.touches.length,a.y/=b.touches.length,e[b.index]=a)}),d=0;d<b.corners.length;d++)b.corners[d].point=e[d];c(b.edges).each(function(a){null!==a.v0&&null!==a.v1&&(a.midpoint=j.interpolate(a.v0.point,a.v1.point,.5))})},b.landCorners=function(a){var b=[];return c(a).each(function(a){a.ocean||a.coast||b.push(a)}),b},b.buildGraph=function(a,e){function i(a){var c;if(null===a)return null;var d;for(d=g.toInt(a.x)-1;d<g.toInt(a.x)+2;d++)if(!g.isUndefinedOrNull(n[d]))for(var e=0;e<n[d].length;e++){c=n[d][e];var h=a.x-c.point.x,i=a.y-c.point.y;if(1e-6>h*h+i*i)return c}return d=g.toInt(a.x),g.isUndefinedOrNull(n[d])&&(n[d]=[]),c=f(),c.index=b.corners.length,b.corners.push(c),c.point=a,c.border=0===a.x||a.x===b.SIZE.width||0===a.y||a.y===b.SIZE.height,c.touches=[],c.protrudes=[],c.adjacent=[],n[d].push(c),c}var k,l=e.edges(),m={};c(a).each(function(a){k=d(),k.index=b.centers.length,k.point=a,k.neighbors=[],k.borders=[],k.corners=[],b.centers.push(k),m[j.hash(a)]=k}),c(b.centers).each(function(a){e.region(a.point)});var n=[];c(l).each(function(a){function c(a,b){null!==b&&a.indexOf(b)<0&&a.push(b)}function d(a,b){null!==b&&a.indexOf(b)<0&&a.push(b)}var e=a.delaunayLine(),f=a.voronoiEdge(),g=h();g.index=b.edges.length,g.river=0,b.edges.push(g),g.midpoint=null!==f.p0&&null!==f.p1?j.interpolate(f.p0,f.p1,.5):null,g.v0=i(f.p0),g.v1=i(f.p1),g.d0=m[j.hash(e.p0)],g.d1=m[j.hash(e.p1)],null!==g.d0&&g.d0.borders.push(g),null!==g.d1&&g.d1.borders.push(g),null!==g.v0&&g.v0.protrudes.push(g),null!==g.v1&&g.v1.protrudes.push(g),null!==g.d0&&null!==g.d1&&(d(g.d0.neighbors,g.d1),d(g.d1.neighbors,g.d0)),null!==g.v0&&null!==g.v1&&(c(g.v0.adjacent,g.v1),c(g.v1.adjacent,g.v0)),null!==g.d0&&(c(g.d0.corners,g.v0),c(g.d0.corners,g.v1)),null!==g.d1&&(c(g.d1.corners,g.v0),c(g.d1.corners,g.v1)),null!==g.v0&&(d(g.v0.touches,g.d0),d(g.v0.touches,g.d1)),null!==g.v1&&(d(g.v1.touches,g.d0),d(g.v1.touches,g.d1))})},b.assignCornerElevations=function(){var a=[];for(c(b.corners).each(function(a){a.water=!b.inside(a.point)}),c(b.corners).each(function(b){b.border?(b.elevation=0,a.push(b)):b.elevation=Number.POSITIVE_INFINITY});a.length>0;)for(var d=a.shift(),e=0;e<d.adjacent.length;e++){var f=d.adjacent[e],g=.01+d.elevation;d.water||f.water||(g+=1),g<f.elevation&&(f.elevation=g,a.push(f))}},b.redistributeElevations=function(a){var b,c,d,e=1.1;for(a.sort(function(a,b){return a.elevation>b.elevation?1:a.elevation<b.elevation?-1:a.index>b.index?1:a.index<b.index?-1:0}),b=0;b<a.length;b++)c=b/(a.length-1),d=Math.sqrt(e)-Math.sqrt(e*(1-c)),d>1&&(d=1),a[b].elevation=d},b.redistributeMoisture=function(a){var b;for(a.sort(function(a,b){return a.moisture>b.moisture?1:a.moisture<b.moisture?-1:a.index>b.index?1:a.index<b.index?-1:0}),b=0;b<a.length;b++)a[b].moisture=b/(a.length-1)},b.assignOceanCoastAndLand=function(a){var d,f,g=[];for(c(b.centers).each(function(b){f=0,c(b.corners).each(function(a){a.border&&(b.border=!0,b.ocean=!0,a.water=!0,g.push(b)),a.water&&(f+=1)}),b.water=b.ocean||f>=b.corners.length*a});g.length>0;){d=g.shift();for(var h=0;h<d.neighbors.length;h++){var i=d.neighbors[h];i.water&&!i.ocean&&(i.ocean=!0,g.push(i))}}c(b.centers).each(function(a){var b=0,d=0;c(a.neighbors).each(function(a){b+=e.intFromBoolean(a.ocean),d+=e.intFromBoolean(!a.water)}),a.coast=b>0&&d>0}),c(b.corners).each(function(a){var b=0,d=0;c(a.touches).each(function(a){b+=e.intFromBoolean(a.ocean),d+=e.intFromBoolean(!a.water)}),a.ocean=b===a.touches.length,a.coast=b>0&&d>0,a.water=a.border||d!==a.touches.length&&!a.coast})},b.assignPolygonElevations=function(){var a;c(b.centers).each(function(b){a=0,c(b.corners).each(function(b){a+=b.elevation}),b.elevation=a/b.corners.length})},b.calculateDownslopes=function(){var a;c(b.corners).each(function(b){a=b,c(b.adjacent).each(function(b){b.elevation<=a.elevation&&(a=b)}),b.downslope=a})},b.calculateWatersheds=function(){var a,d,e;c(b.corners).each(function(a){a.watershed=a,a.ocean||a.coast||(a.watershed=a.downslope)});var f,g;for(d=0;100>d;d++){for(e=!1,f=0;f<b.corners.length;f++)g=b.corners[f],g.ocean||g.coast||g.watershed.coast||(a=g.downslope.watershed,a.ocean||(g.watershed=a),e=!0);if(!e)break}for(f=0;f<b.corners.length;f++)g=b.corners[f],a=g.watershed,a.watershedSize=1+(a.watershedSize||0)},b.createRivers=function(a){a=g.coalesce(a,g.toInt((b.SIZE.width+b.SIZE.height)/4));var c,d,e;for(c=0;a>c;c++)if(d=b.corners[b.mapRandom.nextIntRange(0,b.corners.length-1)],!(d.ocean||d.elevation<.3||d.elevation>.9))for(;!d.coast&&d!==d.downslope;)e=b.lookupEdgeFromCorner(d,d.downslope),e.river=e.river+1,d.river=(d.river||0)+1,d.downslope.river=(d.downslope.river||0)+1,d=d.downslope},b.assignCornerMoisture=function(){var a,d,e=[];for(c(b.corners).each(function(a){(a.water||a.river>0)&&!a.ocean?(a.moisture=a.river>0?Math.min(3,.2*a.river):1,e.push(a)):a.moisture=0});e.length>0;){a=e.shift();for(var f=0;f<a.adjacent.length;f++){var g=a.adjacent[f];d=.9*a.moisture,d>g.moisture&&(g.moisture=d,e.push(g))}}c(b.corners).each(function(a){(a.ocean||a.coast)&&(a.moisture=1)})},b.assignPolygonMoisture=function(){var a;c(b.centers).each(function(b){a=0,c(b.corners).each(function(b){b.moisture>1&&(b.moisture=1),a+=b.moisture}),b.moisture=a/b.corners.length})},b.assignBiomes=function(){c(b.centers).each(function(a){a.biome=m.getBiome(a)})},b.lookupEdgeFromCenter=function(a,b){for(var c=0;c<a.borders.length;c++){var d=a.borders[c];if(d.d0===b||d.d1===b)return d}return null},b.lookupEdgeFromCorner=function(a,b){for(var c=0;c<a.protrudes.length;c++){var d=a.protrudes[c];if(d.v0===b||d.v1===b)return d}return null},b.inside=function(a){return b.islandShape({x:2*(a.x/b.SIZE.width-.5),y:2*(a.y/b.SIZE.height-.5)})},b.reset(),b};m.DEFAULT_LAKE_THRESHOLD=.3,m.DEFAULT_LLOYD_ITERATIONS=2,m.DEFAULT_NUMBER_OF_POINTS=1e3,m.getBiome=function(a){return a.ocean?"OCEAN":a.water?a.elevation<.1?"MARSH":a.elevation>.8?"ICE":"LAKE":a.coast?"BEACH":a.elevation>.8?a.moisture>.5?"SNOW":a.moisture>.33?"TUNDRA":a.moisture>.16?"BARE":"SCORCHED":a.elevation>.6?a.moisture>.66?"TAIGA":a.moisture>.33?"SHRUBLAND":"TEMPERATE_DESERT":a.elevation>.3?a.moisture>.83?"TEMPERATE_RAIN_FOREST":a.moisture>.5?"TEMPERATE_DECIDUOUS_FOREST":a.moisture>.16?"GRASSLAND":"TEMPERATE_DESERT":a.moisture>.66?"TROPICAL_RAIN_FOREST":a.moisture>.33?"TROPICAL_SEASONAL_FOREST":a.moisture>.16?"GRASSLAND":"SUBTROPICAL_DESERT"},m.countLands=function(a){return c(c(a).filter(function(a){return!a.water})).size()},m.tryMutateMapPointsToGetNumberLands=function(a,b,c,d,e,f){c=g.def(c,1e4),d=g.def(d,m.DEFAULT_NUMBER_OF_POINTS),e=g.def(e,m.DEFAULT_LLOYD_ITERATIONS),f=g.def(f,m.DEFAULT_LAKE_THRESHOLD);var h=d,i=Date.now(),j=!1;do{a.go0PlacePoints(h),a.go1ImprovePoints(e),a.go2BuildGraph(),a.go3AssignElevations(f);var k=m.countLands(a.centers);k===b?j=!0:h+=b>k?1:-1}while(!j&&Date.now()-i<c);return a},b.exports=m},{"../as3/conversion-core":2,"../as3/point-core":4,"../as3/rectangle":5,"../janicek/core":10,"../nodename/delaunay/voronoi":33,"../polygonal/pm-prng":38,"./graph/center":40,"./graph/corner":41,"./graph/edge":42,lodash:1}],46:[function(a,b){"use strict";var c=a("lodash"),d=a("../as3/conversion-core"),e=a("../janicek/core"),f=a("../as3/point-core"),g=a("../janicek/pseudo-random-number-generators");b.exports=function(){var a={};return a.path0=[],a.path1=[],a.buildNoisyEdges=function(h,i,j,k){k=e.def(k,.5);var l=g.randomGenerator(j,g.nextParkMiller);c(h.centers).each(function(g){c(g.borders).each(function(c){if(!e.isUndefinedOrNull(c.d0)&&!e.isUndefinedOrNull(c.d1)&&!e.isUndefinedOrNull(c.v0)&&!e.isUndefinedOrNull(c.v1)&&e.isUndefinedOrNull(a.path0[c.index])){var g=k,h=f.interpolate(c.v0.point,c.d0.point,g),j=f.interpolate(c.v0.point,c.d1.point,g),m=f.interpolate(c.v1.point,c.d0.point,g),n=f.interpolate(c.v1.point,c.d1.point,g),o=10;c.d0.biome!==c.d1.biome&&(o=3),c.d0.ocean&&c.d1.ocean&&(o=100),(c.d0.coast||c.d1.coast)&&(o=1),(d.booleanFromInt(c.river)||!e.isUndefinedOrNull(i.lava[c.index]))&&(o=1),a.path0[c.index]=b.exports.buildNoisyLineSegments(l(),c.v0.point,h,c.midpoint,j,o),a.path1[c.index]=b.exports.buildNoisyLineSegments(l(),c.v1.point,n,c.midpoint,m,o)}})})},a},b.exports.buildNoisyLineSegments=function(a,b,c,d,e,h){function i(a,b,c,d){if(!(f.distanceFromOrigin(f.subtract(a,c))<h||f.distanceFromOrigin(f.subtract(b,d))<h)){var e=g.toFloatRange(j(),.2,.8),l=g.toFloatRange(j(),.2,.8),m=f.interpolate(a,d,e),n=f.interpolate(b,c,e),o=f.interpolate(a,b,l),p=f.interpolate(d,c,l),q=f.interpolate(m,n,l),r=1-g.toFloatRange(j(),-.4,.4),s=1-g.toFloatRange(j(),-.4,.4);i(a,f.interpolate(o,b,r),q,f.interpolate(m,d,s)),k.push(q),i(q,f.interpolate(n,c,r),c,f.interpolate(p,d,s))}}var j=g.randomGenerator(a,g.nextParkMiller),k=[];return k.push(b),i(b,c,d,e),k.push(d),k}},{"../as3/conversion-core":2,"../as3/point-core":4,"../janicek/core":10,"../janicek/pseudo-random-number-generators":16,lodash:1}],47:[function(a,b){"use strict";var c=a("lodash"),d=a("../janicek/core");b.exports=function(){var a={};return a.road=[],a.roadConnections=[],a.createRoads=function(b,e){var f,g,h=[],i=[],j=[];for(c(b.centers).each(function(a){(a.coast||a.ocean)&&(j[a.index]=1,h.push(a))});h.length>0;){f=h.shift();for(var k=0;k<f.neighbors.length;k++){var l=f.neighbors[k];for(g=d.coalesce(j[f.index],0);l.elevation>e[g]&&!l.water;)g+=1;g<d.coalesce(j[l.index],999)&&(j[l.index]=g,h.push(l))}}c(b.centers).each(function(a){c(a.corners).each(function(b){i[b.index]=d.toInt(Math.min(d.coalesce(i[b.index],999),d.coalesce(j[a.index],999)))})}),c(b.centers).each(function(b){c(b.borders).each(function(e){c.isNull(e.v0)||c.isNull(e.v1)||i[e.v0.index]===i[e.v1.index]||(a.road[e.index]=d.toInt(Math.min(i[e.v0.index],i[e.v1.index])),d.isUndefinedOrNull(a.roadConnections[b.index])&&(a.roadConnections[b.index]=[]),a.roadConnections[b.index].push(e))})})},a}},{"../janicek/core":10,lodash:1}],48:[function(a,b,c){"use strict";c.displayColors={OCEAN:4473978,COAST:3355482,LAKESHORE:2250120,LAKE:3368601,RIVER:2250120,MARSH:3106406,ICE:10092543,BEACH:10522743,ROAD1:4465169,ROAD2:5583650,ROAD3:6702131,BRIDGE:6842464,LAVA:13382451,SNOW:16777215,TUNDRA:12303274,BARE:8947848,SCORCHED:5592405,TAIGA:10070647,SHRUBLAND:8952183,TEMPERATE_DESERT:13226651,TEMPERATE_RAIN_FOREST:4491349,TEMPERATE_DECIDUOUS_FOREST:6788185,GRASSLAND:8956501,SUBTROPICAL_DESERT:13810059,TROPICAL_RAIN_FOREST:3372885,TROPICAL_SEASONAL_FOREST:5609796},c.elevationGradientColors={OCEAN:34816,GRADIENT_LOW:34816,GRADIENT_HIGH:16776960}},{}],49:[function(a,b){"use strict";var c=a("lodash");b.exports=function(){var a={};return a.lowestCorner=[],a.watersheds=[],a.createWatersheds=function(b){var d;c(b.centers).each(function(b){d=null,c(b.corners).each(function(a){(null===d||a.elevation<d.elevation)&&(d=a)}),a.lowestCorner[b.index]=null===d?-1:d.index,a.watersheds[b.index]=null===d?-1:null===d.watershed?-1:d.watershed.index})},a}},{lodash:1}]},{},[7]);